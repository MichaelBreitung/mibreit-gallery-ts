var k=Object.defineProperty;var D=(u,e,t)=>e in u?k(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t;var a=(u,e,t)=>D(u,typeof e!="symbol"?e+"":e,t);import{createElement as c,addCssStyle as h,appendChildElement as d,cloneElement as B,getElement as x,removeCssStyle as g,setInnerHtml as p,addCssClass as r,prependChildElement as P,getElementDimension as V,getElementPosition as F,addEventListener as m,addKeyEventListener as C,getKeyFromEvent as v}from"../node_modules/mibreit-dom-tools/lib/index.js";import E from"./SlideshowBuilder.js";import H from"./ThumbsScrollerBuilder.js";import S from"../containers/Gallery.js";import A from"../components/Fullscreen.js";import"../node_modules/mibreit-lazy-loader/lib/types/index.js";import _ from"../tools/animations.module.css.js";import N,{ESwipeDirection as I}from"../components/SwipeHandler.js";import O from"../components/AverageColor.js";import y from"../components/ImageDescription.js";import b from"../images/nextImage.svg.js";import K from"../images/fullscreen.svg.js";import L from"../images/info.svg.js";import w from"./GalleryBuilder.module.css.js";class f{constructor(e,t,s=!1){a(this,"_slideshowContainerElement");a(this,"_fullScreenOnly");a(this,"_slideshow");a(this,"_thumbsViewer",null);a(this,"_fullscreen",null);a(this,"_imageDescriptions",null);this._slideshowContainerElement=e,this._slideshow=t,this._fullScreenOnly=s}static fromContainerAndImages(e,t,s){const i=new E(t,s).build();return new f(e,i)}static fromImages(e,t){const s=c("div");h(s,"display","none"),e.forEach(n=>{d(B(n),s)});const i=x("body");d(s,i);const o=s.children,l=new E(o,t).build();return new f(s,l,!0)}addPreviousNextButtons(){if(this._slideshow.getImageViewer().getNumberOfImages()>1){const{previousButton:e,nextButton:t}=this._createPreviousNextButtons();this._setupHoverEvents([e,t])}return this}addFullscreen(e){if(this._fullscreen=new A(this._slideshowContainerElement),e)if(e.useAverageBackgroundColor){const s=this._slideshow.getImageViewer(),i=new O;s.addImageChangedCallback(o=>{i.updateColors(s.getImageElement(o))}),this._fullscreen.setAverageBackgroundColor()}else e.backgroundColor&&this._fullscreen.setBackgroundColor(e.backgroundColor);const t=this._createFullscreenButton();return this._setupHoverEvents([t]),this._setupFullscreenKeyEvents(this._fullscreen),this._setupFullscreenClickEvent(this._fullscreen,t),this._setupFullscreenChangedHandler(this._fullscreen,t),this._fullScreenOnly&&this._fullscreen.addChangedCallback(s=>{s?g(this._slideshowContainerElement,"display"):h(this._slideshowContainerElement,"display","none")}),this}addThumbScroller(e,t,s){return this._thumbsViewer=new H(e,t,s,i=>{this._slideshow.getLoader().setCurrentIndex(i),this._slideshow.getImageViewer().showImage(i)}).addPreviousNextButtons().build(),this._slideshow.getImageViewer().addImageChangedCallback((i,o)=>{this._thumbsViewer.setCenterThumb(i,!0)}),this}addDescriptions(e){if(this._imageDescriptions=[],e)for(let s=0;s<e.length;s++)this._imageDescriptions.push(new y(e[s]));else{const s=this._slideshow.getImageViewer(),i=s.getNumberOfImages();for(let o=0;o<i;o++){const l=new y;l.updateDescription(s.getImageInfo(o).getDescription()),d(l.getDescriptionHandle(),this._slideshowContainerElement),this._imageDescriptions.push(l)}}const t=this._createInfoButton();return this._setupHoverEvents([t]),this._setupInfoClickEvent(t,this._imageDescriptions),this}build(){return this._slideshow.getImageViewer().getNumberOfImages()>1&&(this._setupSwipeHandler(this._slideshow.getImageViewer()),this._setupKeyEvents(this._slideshow.getImageViewer())),new S(this._slideshow.getImageViewer(),this._slideshow.getLoader(),this._thumbsViewer,this._fullscreen,this._imageDescriptions)}_createPreviousNextButtons(){const e=c("div");p(e,b),r(e,w.gallery__previous_btn),r(e,_.fade),P(e,this._slideshowContainerElement);const t=c("div");return p(t,b),r(t,w.gallery__next_btn),r(t,_.fade),d(t,this._slideshowContainerElement),{previousButton:e,nextButton:t}}_setupSwipeHandler(e){h(this._slideshowContainerElement,"touch-action","pinch-zoom pan-y"),new N(this._slideshowContainerElement,(t,s)=>{if(t===I.LEFT)e.showPreviousImage(t);else if(t===I.RIGHT)e.showNextImage(t);else{const i=V(this._slideshowContainerElement).width,o=F(this._slideshowContainerElement).x;s.x-o>i/2?e.showNextImage():e.showPreviousImage()}})}_setupHoverEvents(e){m(this._slideshowContainerElement,"mouseenter",()=>{e.forEach(t=>{g(t,"opacity")})}),m(this._slideshowContainerElement,"mouseleave",()=>{e.forEach(t=>{h(t,"opacity","0")})})}_setupKeyEvents(e){C(t=>{switch(v(t)){case"ArrowRight":e.showNextImage();break;case"ArrowLeft":e.showPreviousImage();break}})}_setupFullscreenKeyEvents(e){C(t=>{switch(v(t)){case"Escape":e.deActivate();break;case"f":e.isActive()?e.deActivate():e.activate();break}})}_createFullscreenButton(){const e=c("div");return p(e,K),r(e,w.gallery__fullscreen_btn),r(e,_.fade),d(e,this._slideshowContainerElement),e}_setupFullscreenClickEvent(e,t){m(t,"pointerdown",s=>{s.stopPropagation()}),m(t,"pointerup",s=>{s.stopPropagation(),e.isActive()||(e.activate(),h(t,"display","none"))})}_setupFullscreenChangedHandler(e,t){e.addChangedCallback(s=>{s?h(t,"display","none"):g(t,"display")})}_createInfoButton(){const e=c("div");return p(e,L),r(e,w.gallery__info_btn),r(e,_.fade),d(e,this._slideshowContainerElement),e}_setupInfoClickEvent(e,t){let s=null;const i=n=>{n?h(e,"display","none"):(s=null,g(e,"display"))};t.forEach(n=>{n.addChangedCallback(i)});const o=n=>{l(),n>=0&&n<this._imageDescriptions.length&&(s=n,t[s].show())},l=()=>{s!==null&&(t[s].hide(),s=null)};m(e,"pointerdown",n=>{n.stopPropagation()}),m(e,"pointerup",n=>{n.stopPropagation(),o(this._slideshow.getImageViewer().getImageIndex())}),this._slideshow.getImageViewer().addImageChangedCallback(n=>{s!==null&&o(n)})}}export{f as default};
