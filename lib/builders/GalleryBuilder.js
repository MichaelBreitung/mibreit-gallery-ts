var k=Object.defineProperty;var x=(a,e,t)=>e in a?k(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var r=(a,e,t)=>x(a,typeof e!="symbol"?e+"":e,t);import{FastAverageColor as B}from"../node_modules/fast-average-color/dist/index.esm.js";import{createElement as d,addCssStyle as n,appendChildElement as m,cloneElement as F,getElement as A,removeCssStyle as f,setInnerHtml as c,addCssClass as l,prependChildElement as S,getElementDimension as P,getElementPosition as H,addEventListener as u,addKeyEventListener as C,getKeyFromEvent as v}from"../node_modules/mibreit-dom-tools/lib/index.js";import E from"./SlideshowBuilder.js";import N from"./ThumbsScrollerBuilder.js";import V from"../containers/Gallery.js";import L from"../components/Fullscreen.js";import O,{ESwipeDirection as y}from"../components/SwipeHandler.js";import{checkFullscreenConfig as T}from"../types/index.js";import I from"../images/nextImage.svg.js";import K from"../images/fullscreen.svg.js";import _ from"./GalleryBuilder.module.css.js";import w from"../tools/animations.module.css.js";import{GALLERY_BUTTONS_SHOW_OPACITY as R}from"../constants.js";class g{constructor(e,t,s=!1){r(this,"_slideshowContainerElement");r(this,"_fullScreenOnly");r(this,"_slideshow");r(this,"_thumbsViewer",null);r(this,"_fullscreen",null);this._slideshowContainerElement=e,this._slideshow=t,this._fullScreenOnly=s}static fromContainerAndImages(e,t,s){const i=new E(t,s).build();return new g(e,i)}static fromImages(e,t){const s=d("div");n(s,"display","none"),e.forEach(h=>{m(F(h),s)});const i=A("body");m(s,i);const o=s.children,p=new E(o,t).build();return new g(s,p,!0)}addPreviousNextButtons(){if(this._slideshow.getImageViewer().getNumberOfImages()>1){const{previousButton:e,nextButton:t}=this._createPreviousNextButtons();this._setupHoverEvents([e,t])}return this}addFullscreen(e){if(this._fullscreen=new L(this._slideshowContainerElement),e&&(T(e),e.backgroundColor&&this._fullscreen.setBackgroundColor(e.backgroundColor),e.useAverageBackgroundColor)){const s=new B,i=this._slideshow.getImageViewer();i.addImageChangedCallback((o,p)=>{var h;if((h=this._fullscreen)!=null&&h.isActive()){const b=s.getColor(i.getImageElement(o),{algorithm:"sqrt"});this._fullscreen.setBackgroundColor(b.rgb)}})}const t=this._createFullscreenButton();return this._setupHoverEvents([t]),this._setupFullscreenKeyEvents(this._fullscreen),this._setupFullscreenClickEvent(this._fullscreen,t),this._setupFullscreenChangedHandler(this._fullscreen,t),this._fullScreenOnly&&this._fullscreen.addChangedCallback(s=>{s?f(this._slideshowContainerElement,"display"):n(this._slideshowContainerElement,"display","none")}),this}addThumbScroller(e,t,s){return this._thumbsViewer=new N(e,t,s,i=>{this._slideshow.getLoader().setCurrentIndex(i),this._slideshow.getImageViewer().showImage(i)}).addPreviousNextButtons().build(),this._slideshow.getImageViewer().addImageChangedCallback((i,o)=>{this._thumbsViewer.setCenterThumb(i,!0)}),this}build(){return this._slideshow.getImageViewer().getNumberOfImages()>1&&(this._setupSwipeHandler(this._slideshow.getImageViewer()),this._setupKeyEvents(this._slideshow.getImageViewer())),new V(this._slideshow.getImageViewer(),this._slideshow.getLoader(),this._thumbsViewer,this._fullscreen)}_createPreviousNextButtons(){const e=d("div");c(e,I),l(e,_.gallery__previous_btn),l(e,w.fade),S(e,this._slideshowContainerElement);const t=d("div");return c(t,I),l(t,_.gallery__next_btn),l(t,w.fade),m(t,this._slideshowContainerElement),{previousButton:e,nextButton:t}}_setupSwipeHandler(e){n(this._slideshowContainerElement,"touch-action","pinch-zoom pan-y"),new O(this._slideshowContainerElement,(t,s)=>{const i=P(this._slideshowContainerElement).width,o=H(this._slideshowContainerElement).x;t===y.LEFT?e.showPreviousImage(t):t===y.RIGHT?e.showNextImage(t):s.x-o>i/2?e.showNextImage():e.showPreviousImage()})}_setupHoverEvents(e){u(this._slideshowContainerElement,"mouseenter",()=>{e.forEach(t=>{n(t,"opacity",`${R}`)})}),u(this._slideshowContainerElement,"mouseleave",()=>{e.forEach(t=>{n(t,"opacity","0")})})}_setupKeyEvents(e){C(t=>{switch(v(t)){case"ArrowRight":e.showNextImage();break;case"ArrowLeft":e.showPreviousImage();break}})}_setupFullscreenKeyEvents(e){C(t=>{switch(v(t)){case"Escape":e.deActivate();break;case"f":e.isActive()?e.deActivate():e.activate();break}})}_createFullscreenButton(){const e=d("div");return c(e,K),l(e,_.gallery__fullscreen_btn),l(e,w.fade),m(e,this._slideshowContainerElement),e}_setupFullscreenClickEvent(e,t){u(t,"pointerdown",s=>{s.stopPropagation()}),u(t,"pointerup",s=>{s.stopPropagation(),e.isActive()||(e.activate(),n(t,"display","none"))})}_setupFullscreenChangedHandler(e,t){e.addChangedCallback(s=>{s?n(t,"display","none"):f(t,"display")})}}export{g as default};
