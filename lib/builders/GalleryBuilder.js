var b=Object.defineProperty;var k=(d,e,t)=>e in d?b(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var l=(d,e,t)=>k(d,typeof e!="symbol"?e+"":e,t);import{createElement as m,addCssStyle as a,appendChildElement as u,cloneElement as B,getElement as x,removeCssStyle as c,setInnerHtml as g,addCssClass as r,prependChildElement as D,getElementDimension as P,getElementPosition as F,addEventListener as h,addKeyEventListener as C,getKeyFromEvent as v}from"../node_modules/mibreit-dom-tools/lib/index.js";import E from"./SlideshowBuilder.js";import S from"./ThumbsScrollerBuilder.js";import V from"../containers/Gallery.js";import A from"../components/Fullscreen.js";import"../node_modules/mibreit-lazy-loader/lib/types/index.js";import _ from"../tools/animations.module.css.js";import H,{ESwipeDirection as I}from"../components/SwipeHandler.js";import N from"../components/AverageColor.js";import K from"../components/ImageDescription.js";import y from"../images/nextImage.svg.js";import L from"../images/fullscreen.svg.js";import O from"../images/info.svg.js";import p from"./GalleryBuilder.module.css.js";class f{constructor(e,t,s=!1){l(this,"_slideshowContainerElement");l(this,"_fullScreenOnly");l(this,"_slideshow");l(this,"_thumbsViewer",null);l(this,"_fullscreen",null);l(this,"_imageDescriptions",null);this._slideshowContainerElement=e,this._slideshow=t,this._fullScreenOnly=s}static fromContainerAndImages(e,t,s){const n=new E(t,s).build();return new f(e,n)}static fromImages(e,t){const s=m("div");a(s,"display","none"),e.forEach(i=>{u(B(i),s)});const n=x("body");u(s,n);const o=s.children,w=new E(o,t).build();return new f(s,w,!0)}addPreviousNextButtons(){if(this._slideshow.getImageViewer().getNumberOfImages()>1){const{previousButton:e,nextButton:t}=this._createPreviousNextButtons();this._setupHoverEvents([e,t])}return this}addFullscreen(e){if(this._fullscreen=new A(this._slideshowContainerElement),e)if(e.useAverageBackgroundColor){const s=this._slideshow.getImageViewer(),n=new N;s.addImageChangedCallback(o=>{n.updateColors(s.getImageElement(o))}),this._fullscreen.setAverageBackgroundColor()}else e.backgroundColor&&this._fullscreen.setBackgroundColor(e.backgroundColor);const t=this._createFullscreenButton();return this._setupHoverEvents([t]),this._setupFullscreenKeyEvents(this._fullscreen),this._setupFullscreenClickEvent(this._fullscreen,t),this._setupFullscreenChangedHandler(this._fullscreen,t),this._fullScreenOnly&&this._fullscreen.addChangedCallback(s=>{s?c(this._slideshowContainerElement,"display"):a(this._slideshowContainerElement,"display","none")}),this}addThumbScroller(e,t,s){return this._thumbsViewer=new S(e,t,s,n=>{this._slideshow.getLoader().setCurrentIndex(n),this._slideshow.getImageViewer().showImage(n)}).addPreviousNextButtons().build(),this._slideshow.getImageViewer().addImageChangedCallback((n,o)=>{this._thumbsViewer.setCenterThumb(n,!0)}),this}addDescriptions(e){this._imageDescriptions=[];for(let s=0;s<e.length;s++)this._imageDescriptions.push(new K(e[s]));const t=this._createInfoButton();return this._setupHoverEvents([t]),this._setupInfoClickEvent(t,this._imageDescriptions),this}build(){return this._slideshow.getImageViewer().getNumberOfImages()>1&&(this._setupSwipeHandler(this._slideshow.getImageViewer()),this._setupKeyEvents(this._slideshow.getImageViewer())),new V(this._slideshow.getImageViewer(),this._slideshow.getLoader(),this._thumbsViewer,this._fullscreen,this._imageDescriptions)}_createPreviousNextButtons(){const e=m("div");g(e,y),r(e,p.gallery__previous_btn),r(e,_.fade),D(e,this._slideshowContainerElement);const t=m("div");return g(t,y),r(t,p.gallery__next_btn),r(t,_.fade),u(t,this._slideshowContainerElement),{previousButton:e,nextButton:t}}_setupSwipeHandler(e){a(this._slideshowContainerElement,"touch-action","pinch-zoom pan-y"),new H(this._slideshowContainerElement,(t,s)=>{if(t===I.LEFT)e.showPreviousImage(t);else if(t===I.RIGHT)e.showNextImage(t);else{const n=P(this._slideshowContainerElement).width,o=F(this._slideshowContainerElement).x;s.x-o>n/2?e.showNextImage():e.showPreviousImage()}})}_setupHoverEvents(e){h(this._slideshowContainerElement,"mouseenter",()=>{e.forEach(t=>{c(t,"opacity")})}),h(this._slideshowContainerElement,"mouseleave",()=>{e.forEach(t=>{a(t,"opacity","0")})})}_setupKeyEvents(e){C(t=>{switch(v(t)){case"ArrowRight":e.showNextImage();break;case"ArrowLeft":e.showPreviousImage();break}})}_setupFullscreenKeyEvents(e){C(t=>{switch(v(t)){case"Escape":e.deActivate();break;case"f":e.isActive()?e.deActivate():e.activate();break}})}_createFullscreenButton(){const e=m("div");return g(e,L),r(e,p.gallery__fullscreen_btn),r(e,_.fade),u(e,this._slideshowContainerElement),e}_setupFullscreenClickEvent(e,t){h(t,"pointerdown",s=>{s.stopPropagation()}),h(t,"pointerup",s=>{s.stopPropagation(),e.isActive()||(e.activate(),a(t,"display","none"))})}_setupFullscreenChangedHandler(e,t){e.addChangedCallback(s=>{s?a(t,"display","none"):c(t,"display")})}_createInfoButton(){const e=m("div");return g(e,O),r(e,p.gallery__info_btn),r(e,_.fade),u(e,this._slideshowContainerElement),e}_setupInfoClickEvent(e,t){let s=null;const n=i=>{i?a(e,"display","none"):(s=null,c(e,"display"))};t.forEach(i=>{i.addChangedCallback(n)});const o=i=>{w(),i>=0&&i<this._imageDescriptions.length&&(s=i,t[s].show())},w=()=>{s!==null&&(t[s].hide(),s=null)};h(e,"pointerdown",i=>{i.stopPropagation()}),h(e,"pointerup",i=>{i.stopPropagation(),o(this._slideshow.getImageViewer().getImageIndex())}),this._slideshow.getImageViewer().addImageChangedCallback(i=>{s!==null&&o(i)})}}export{f as default};
