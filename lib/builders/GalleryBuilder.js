var k=Object.defineProperty;var B=(h,e,t)=>e in h?k(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var l=(h,e,t)=>B(h,typeof e!="symbol"?e+"":e,t);import{FastAverageColor as x}from"../node_modules/fast-average-color/dist/index.esm.js";import{createElement as m,addCssStyle as o,appendChildElement as u,cloneElement as A,getElement as F,removeCssStyle as f,setInnerHtml as _,addCssClass as a,prependChildElement as S,getElementDimension as H,getElementPosition as P,addEventListener as c,addKeyEventListener as C,getKeyFromEvent as v}from"../node_modules/mibreit-dom-tools/lib/index.js";import E from"./SlideshowBuilder.js";import N from"./ThumbsScrollerBuilder.js";import V from"../containers/Gallery.js";import L from"../components/Fullscreen.js";import"../node_modules/mibreit-lazy-loader/lib/types/index.js";import{GALLERY_BUTTONS_SHOW_OPACITY as O}from"../constants.js";import g from"../tools/animations.module.css.js";import T,{ESwipeDirection as I}from"../components/SwipeHandler.js";import{checkFullscreenConfig as K}from"../types/index.js";import b from"../images/nextImage.svg.js";import q from"../images/fullscreen.svg.js";import w from"./GalleryBuilder.module.css.js";class p{constructor(e,t,s=!1){l(this,"_slideshowContainerElement");l(this,"_fullScreenOnly");l(this,"_slideshow");l(this,"_thumbsViewer",null);l(this,"_fullscreen",null);this._slideshowContainerElement=e,this._slideshow=t,this._fullScreenOnly=s}static fromContainerAndImages(e,t,s){const n=new E(t,s).build();return new p(e,n)}static fromImages(e,t){const s=m("div");o(s,"display","none"),e.forEach(r=>{u(A(r),s)});const n=F("body");u(s,n);const i=s.children,d=new E(i,t).build();return new p(s,d,!0)}addPreviousNextButtons(){if(this._slideshow.getImageViewer().getNumberOfImages()>1){const{previousButton:e,nextButton:t}=this._createPreviousNextButtons();this._setupHoverEvents([e,t])}return this}addFullscreen(e){if(this._fullscreen=new L(this._slideshowContainerElement),e&&(K(e),e.backgroundColor&&this._fullscreen.setBackgroundColor(e.backgroundColor),e.useAverageBackgroundColor)){const s=new x,n=this._slideshow.getImageViewer();n.addImageChangedCallback((i,d)=>{var r;if((r=this._fullscreen)!=null&&r.isActive()){const y=s.getColor(n.getImageElement(i),{algorithm:"sqrt",silent:!0});this._fullscreen.setBackgroundColor(y.rgb)}}),this._fullscreen.addChangedCallback(i=>{var d;if(i){const r=s.getColor(n.getImageElement(n.getImageIndex()),{algorithm:"sqrt"});(d=this._fullscreen)==null||d.setBackgroundColor(r.rgb)}})}const t=this._createFullscreenButton();return this._setupHoverEvents([t]),this._setupFullscreenKeyEvents(this._fullscreen),this._setupFullscreenClickEvent(this._fullscreen,t),this._setupFullscreenChangedHandler(this._fullscreen,t),this._fullScreenOnly&&this._fullscreen.addChangedCallback(s=>{s?f(this._slideshowContainerElement,"display"):o(this._slideshowContainerElement,"display","none")}),this}addThumbScroller(e,t,s){return this._thumbsViewer=new N(e,t,s,n=>{this._slideshow.getLoader().setCurrentIndex(n),this._slideshow.getImageViewer().showImage(n)}).addPreviousNextButtons().build(),this._slideshow.getImageViewer().addImageChangedCallback((n,i)=>{this._thumbsViewer.setCenterThumb(n,!0)}),this}build(){return this._slideshow.getImageViewer().getNumberOfImages()>1&&(this._setupSwipeHandler(this._slideshow.getImageViewer()),this._setupKeyEvents(this._slideshow.getImageViewer())),new V(this._slideshow.getImageViewer(),this._slideshow.getLoader(),this._thumbsViewer,this._fullscreen)}_createPreviousNextButtons(){const e=m("div");_(e,b),a(e,w.gallery__previous_btn),a(e,g.fade),S(e,this._slideshowContainerElement);const t=m("div");return _(t,b),a(t,w.gallery__next_btn),a(t,g.fade),u(t,this._slideshowContainerElement),{previousButton:e,nextButton:t}}_setupSwipeHandler(e){o(this._slideshowContainerElement,"touch-action","pinch-zoom pan-y"),new T(this._slideshowContainerElement,(t,s)=>{if(t===I.LEFT||t===I.RIGHT)e.showNextImage(t);else{const n=H(this._slideshowContainerElement).width,i=P(this._slideshowContainerElement).x;s.x-i>n/2?e.showNextImage():e.showPreviousImage()}})}_setupHoverEvents(e){c(this._slideshowContainerElement,"mouseenter",()=>{e.forEach(t=>{o(t,"opacity",`${O}`)})}),c(this._slideshowContainerElement,"mouseleave",()=>{e.forEach(t=>{o(t,"opacity","0")})})}_setupKeyEvents(e){C(t=>{switch(v(t)){case"ArrowRight":e.showNextImage();break;case"ArrowLeft":e.showPreviousImage();break}})}_setupFullscreenKeyEvents(e){C(t=>{switch(v(t)){case"Escape":e.deActivate();break;case"f":e.isActive()?e.deActivate():e.activate();break}})}_createFullscreenButton(){const e=m("div");return _(e,q),a(e,w.gallery__fullscreen_btn),a(e,g.fade),u(e,this._slideshowContainerElement),e}_setupFullscreenClickEvent(e,t){c(t,"pointerdown",s=>{s.stopPropagation()}),c(t,"pointerup",s=>{s.stopPropagation(),e.isActive()||(e.activate(),o(t,"display","none"))})}_setupFullscreenChangedHandler(e,t){e.addChangedCallback(s=>{s?o(t,"display","none"):f(t,"display")})}}export{p as default};
