var b=Object.defineProperty;var x=(r,e,t)=>e in r?b(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var o=(r,e,t)=>x(r,typeof e!="symbol"?e+"":e,t);import{createElement as h,addCssStyle as i,appendChildElement as d,cloneElement as k,getElement as S,removeCssStyle as p,setInnerHtml as u,addCssClass as l,prependChildElement as F,getElementDimension as P,getElementPosition as B,addEventListener as m,addKeyEventListener as g,getKeyFromEvent as f}from"../node_modules/mibreit-dom-tools/lib/index.js";import E from"./SlideshowBuilder.js";import H from"./ThumbsScrollerBuilder.js";import N from"../containers/Gallery.js";import A from"../components/Fullscreen.js";import L,{ESwipeDirection as v}from"../components/SwipeHandler.js";import C from"../images/nextImage.svg.js";import O from"../images/fullscreen.svg.js";import c from"./GalleryBuilder.module.css.js";import _ from"../tools/animations.module.css.js";import{GALLERY_BUTTONS_SHOW_OPACITY as T}from"../constants.js";class w{constructor(e,t,s=!1){o(this,"_slideshowContainerElement");o(this,"_fullScreenOnly");o(this,"_slideshow");o(this,"_thumbsViewer",null);o(this,"_fullscreen",null);this._slideshowContainerElement=e,this._slideshow=t,this._fullScreenOnly=s}static fromContainerAndImages(e,t,s){const n=new E(t,s).build();return new w(e,n)}static fromImages(e,t){const s=h("div");i(s,"display","none"),e.forEach(I=>{d(k(I),s)});const n=S("body");d(s,n);const a=s.children,y=new E(a,t).build();return new w(s,y,!0)}addPreviousNextButtons(){if(this._slideshow.getImageViewer().getNumberOfImages()>1){const{previousButton:e,nextButton:t}=this._createPreviousNextButtons();this._setupHoverEvents([e,t])}return this}addFullscreen(){this._fullscreen=new A(this._slideshowContainerElement);const e=this._createFullscreenButton();return this._setupHoverEvents([e]),this._setupFullscreenKeyEvents(this._fullscreen),this._setupFullscreenClickEvent(this._fullscreen,e),this._setupFullscreenChangedHandler(this._fullscreen,e),this._fullScreenOnly&&this._fullscreen.addChangedCallback(t=>{t?p(this._slideshowContainerElement,"display"):i(this._slideshowContainerElement,"display","none")}),this}addThumbScroller(e,t,s){return this._thumbsViewer=new H(e,t,s,n=>{this._slideshow.getLoader().setCurrentIndex(n),this._slideshow.getImageViewer().showImage(n)}).addPreviousNextButtons().build(),this._slideshow.getImageViewer().addImageChangedCallback((n,a)=>{this._thumbsViewer.setCenterThumb(n,!0)}),this}build(){return this._slideshow.getImageViewer().getNumberOfImages()>1&&(this._setupSwipeHandler(this._slideshow.getImageViewer()),this._setupKeyEvents(this._slideshow.getImageViewer())),new N(this._slideshow.getImageViewer(),this._slideshow.getLoader(),this._thumbsViewer,this._fullscreen)}_createPreviousNextButtons(){const e=h("div");u(e,C),l(e,c.gallery__previous_btn),l(e,_.fade),F(e,this._slideshowContainerElement);const t=h("div");return u(t,C),l(t,c.gallery__next_btn),l(t,_.fade),d(t,this._slideshowContainerElement),{previousButton:e,nextButton:t}}_setupSwipeHandler(e){i(this._slideshowContainerElement,"touch-action","pinch-zoom pan-y"),new L(this._slideshowContainerElement,(t,s)=>{const n=P(this._slideshowContainerElement).width,a=B(this._slideshowContainerElement).x;t===v.LEFT?e.showPreviousImage(t):t===v.RIGHT?e.showNextImage(t):s.x-a>n/2?e.showNextImage():e.showPreviousImage()})}_setupHoverEvents(e){m(this._slideshowContainerElement,"mouseenter",()=>{e.forEach(t=>{i(t,"opacity",`${T}`)})}),m(this._slideshowContainerElement,"mouseleave",()=>{e.forEach(t=>{i(t,"opacity","0")})})}_setupKeyEvents(e){g(t=>{switch(f(t)){case"ArrowRight":e.showNextImage();break;case"ArrowLeft":e.showPreviousImage();break}})}_setupFullscreenKeyEvents(e){g(t=>{switch(f(t)){case"Escape":e.deActivate();break;case"f":e.isActive()?e.deActivate():e.activate();break}})}_createFullscreenButton(){const e=h("div");return u(e,O),l(e,c.gallery__fullscreen_btn),l(e,_.fade),d(e,this._slideshowContainerElement),e}_setupFullscreenClickEvent(e,t){m(t,"pointerdown",s=>{s.stopPropagation()}),m(t,"pointerup",s=>{s.stopPropagation(),e.isActive()||(e.activate(),i(t,"display","none"))})}_setupFullscreenChangedHandler(e,t){e.addChangedCallback(s=>{s?i(t,"display","none"):p(t,"display")})}}export{w as default};
