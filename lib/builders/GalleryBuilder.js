var k=Object.defineProperty;var B=(g,e,t)=>e in g?k(g,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[e]=t;var d=(g,e,t)=>B(g,typeof e!="symbol"?e+"":e,t);import{createElement as u,addCssStyle as l,appendChildElement as m,cloneElement as S,getElement as P,removeCssStyle as c,setInnerHtml as p,addCssClass as a,addEventListener as r,prependChildElement as V,getElementDimension as D,getElementPosition as x,addKeyEventListener as I,getKeyFromEvent as C}from"../node_modules/mibreit-dom-tools/lib/index.js";import v from"./SlideshowBuilder.js";import H from"./ThumbsScrollerBuilder.js";import N from"../containers/Gallery.js";import F from"../components/Fullscreen.js";import"../node_modules/mibreit-lazy-loader/lib/types/index.js";import _ from"../tools/animations.module.css.js";import A,{ESwipeDirection as E}from"../components/SwipeHandler.js";import O from"../components/AverageColor.js";import y from"../components/ImageDescription.js";import b from"../images/nextImage.svg.js";import K from"../images/fullscreen.svg.js";import L from"../images/info.svg.js";import T from"../images/shop.svg.js";import w from"./GalleryBuilder.module.css.js";class f{constructor(e,t,s=!1){d(this,"_slideshowContainerElement");d(this,"_fullScreenOnly");d(this,"_slideshow");d(this,"_thumbsViewer",null);d(this,"_fullscreen",null);d(this,"_imageDescriptions",null);this._slideshowContainerElement=e,this._slideshow=t,this._fullScreenOnly=s}static fromContainerAndImages(e,t,s){const i=new v(t,s).build();return new f(e,i)}static fromImages(e,t){const s=u("div");l(s,"display","none"),e.forEach(o=>{m(S(o),s)});const i=P("body");m(s,i);const n=s.children,h=new v(n,t).build();return new f(s,h,!0)}addPreviousNextButtons(){if(this._slideshow.getImageViewer().getNumberOfImages()>1){const{previousButton:e,nextButton:t}=this._createPreviousNextButtons();this._setupHoverEvents([e,t])}return this}addFullscreen(e){if(this._fullscreen=new F(this._slideshowContainerElement),e)if(e.useAverageBackgroundColor){const s=this._slideshow.getImageViewer(),i=new O;s.addImageChangedCallback(n=>{i.updateColors(s.getImageElement(n))}),this._fullscreen.setAverageBackgroundColor()}else e.backgroundColor&&this._fullscreen.setBackgroundColor(e.backgroundColor);const t=this._createFullscreenButton();return this._setupHoverEvents([t]),this._setupFullscreenKeyEvents(this._fullscreen),this._setupFullscreenClickEvent(this._fullscreen,t),this._setupFullscreenChangedHandler(this._fullscreen,t),this._fullScreenOnly&&this._fullscreen.addChangedCallback(s=>{s?c(this._slideshowContainerElement,"display"):l(this._slideshowContainerElement,"display","none")}),this}addThumbScroller(e,t,s){return this._thumbsViewer=new H(e,t,s,i=>{this._slideshow.getLoader().setCurrentIndex(i),this._slideshow.getImageViewer().showImage(i)}).addPreviousNextButtons().build(),this._slideshow.getImageViewer().addImageChangedCallback((i,n)=>{this._thumbsViewer.setCenterThumb(i,!0)}),this}addDescriptions(e){if(this._imageDescriptions=[],e&&e.length===this._slideshow.getImageViewer().getNumberOfImages())for(let s=0;s<e.length;s++)this._imageDescriptions.push(new y(e[s]));else{const s=this._slideshow.getImageViewer(),i=s.getNumberOfImages();for(let n=0;n<i;n++){const h=new y;h.updateDescription(s.getImageInfo(n).getDescription()),m(h.getDescriptionHandle(),this._slideshowContainerElement),this._imageDescriptions.push(h)}}const t=this._createInfoButton();return this._setupHoverEvents([t]),this._setupInfoClickEvent(t,this._imageDescriptions),this}addBuyImageCallback(e){const t=this._slideshow.getImageViewer(),s=this._createShopButton();this._setupShopButtonVisibility(s),this._setupShopButtonClickEvent(s,()=>{var n;const i=t.getImageIndex();(n=t.getImageInfo(i))!=null&&n.hasPrintMeta()&&e(i)})}build(){return this._slideshow.getImageViewer().getNumberOfImages()>1&&(this._setupSwipeHandler(this._slideshow.getImageViewer()),this._setupKeyEvents(this._slideshow.getImageViewer())),new N(this._slideshow.getImageViewer(),this._slideshow.getLoader(),this._thumbsViewer,this._fullscreen,this._imageDescriptions)}_createShopButton(){const e=u("div");return p(e,T),a(e,w.gallery__shop_btn),a(e,_.fade),m(e,this._slideshowContainerElement),e}_setupShopButtonVisibility(e){const t=this._slideshow.getImageViewer();let s=!1;t.addImageChangedCallback(i=>{var n;(n=t.getImageInfo(i))!=null&&n.hasPrintMeta()?s&&c(e,"opacity"):l(e,"opacity","0")}),r(this._slideshowContainerElement,"mouseenter",()=>{var n;const i=t.getImageIndex();s=!0,(n=t.getImageInfo(i))!=null&&n.hasPrintMeta()&&c(e,"opacity")}),r(this._slideshowContainerElement,"mouseleave",()=>{s=!1,l(e,"opacity","0")})}_setupShopButtonClickEvent(e,t){r(e,"pointerdown",s=>{s.stopPropagation()}),r(e,"pointerup",s=>{s.stopPropagation(),t()})}_createPreviousNextButtons(){const e=u("div");p(e,b),a(e,w.gallery__previous_btn),a(e,_.fade),V(e,this._slideshowContainerElement);const t=u("div");return p(t,b),a(t,w.gallery__next_btn),a(t,_.fade),m(t,this._slideshowContainerElement),{previousButton:e,nextButton:t}}_setupSwipeHandler(e){l(this._slideshowContainerElement,"touch-action","pinch-zoom pan-y"),new A(this._slideshowContainerElement,(t,s)=>{if(t===E.LEFT)e.showPreviousImage(t);else if(t===E.RIGHT)e.showNextImage(t);else{const i=D(this._slideshowContainerElement).width,n=x(this._slideshowContainerElement).x;s.x-n>i/2?e.showNextImage():e.showPreviousImage()}})}_setupHoverEvents(e){r(this._slideshowContainerElement,"mouseenter",()=>{e.forEach(t=>{c(t,"opacity")})}),r(this._slideshowContainerElement,"mouseleave",()=>{e.forEach(t=>{l(t,"opacity","0")})})}_setupKeyEvents(e){I(t=>{switch(C(t)){case"ArrowRight":e.showNextImage();break;case"ArrowLeft":e.showPreviousImage();break}})}_setupFullscreenKeyEvents(e){I(t=>{switch(C(t)){case"Escape":e.deActivate();break;case"f":e.isActive()?e.deActivate():e.activate();break}})}_createFullscreenButton(){const e=u("div");return p(e,K),a(e,w.gallery__fullscreen_btn),a(e,_.fade),m(e,this._slideshowContainerElement),e}_setupFullscreenClickEvent(e,t){r(t,"pointerdown",s=>{s.stopPropagation()}),r(t,"pointerup",s=>{s.stopPropagation(),e.isActive()||(e.activate(),l(t,"display","none"))})}_setupFullscreenChangedHandler(e,t){e.addChangedCallback(s=>{s?l(t,"display","none"):c(t,"display")})}_createInfoButton(){const e=u("div");return p(e,L),a(e,w.gallery__info_btn),a(e,_.fade),m(e,this._slideshowContainerElement),e}_setupInfoClickEvent(e,t){let s=null;const i=o=>{o?l(e,"display","none"):(s=null,c(e,"display"))};t.forEach(o=>{o.addChangedCallback(i)});const n=o=>{h(),o>=0&&o<this._imageDescriptions.length&&(s=o,t[s].show())},h=()=>{s!==null&&(t[s].hide(),s=null)};r(e,"pointerdown",o=>{o.stopPropagation()}),r(e,"pointerup",o=>{o.stopPropagation(),n(this._slideshow.getImageViewer().getImageIndex())}),this._slideshow.getImageViewer().addImageChangedCallback(o=>{s!==null&&n(o)})}}export{f as default};
