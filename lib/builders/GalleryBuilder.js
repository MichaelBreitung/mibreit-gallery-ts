var k=Object.defineProperty;var B=(h,e,s)=>e in h?k(h,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):h[e]=s;var l=(h,e,s)=>B(h,typeof e!="symbol"?e+"":e,s);import{FastAverageColor as x}from"../node_modules/fast-average-color/dist/index.esm.js";import{createElement as m,addCssStyle as o,appendChildElement as u,cloneElement as A,getElement as F,removeCssStyle as f,setInnerHtml as _,addCssClass as a,prependChildElement as S,getElementDimension as P,getElementPosition as H,addEventListener as c,addKeyEventListener as C,getKeyFromEvent as v}from"../node_modules/mibreit-dom-tools/lib/index.js";import E from"./SlideshowBuilder.js";import N from"./ThumbsScrollerBuilder.js";import V from"../containers/Gallery.js";import L from"../components/Fullscreen.js";import O,{ESwipeDirection as I}from"../components/SwipeHandler.js";import{checkFullscreenConfig as T}from"../types/index.js";import b from"../images/nextImage.svg.js";import K from"../images/fullscreen.svg.js";import g from"./GalleryBuilder.module.css.js";import w from"../tools/animations.module.css.js";import{GALLERY_BUTTONS_SHOW_OPACITY as q}from"../constants.js";class p{constructor(e,s,t=!1){l(this,"_slideshowContainerElement");l(this,"_fullScreenOnly");l(this,"_slideshow");l(this,"_thumbsViewer",null);l(this,"_fullscreen",null);this._slideshowContainerElement=e,this._slideshow=s,this._fullScreenOnly=t}static fromContainerAndImages(e,s,t){const n=new E(s,t).build();return new p(e,n)}static fromImages(e,s){const t=m("div");o(t,"display","none"),e.forEach(r=>{u(A(r),t)});const n=F("body");u(t,n);const i=t.children,d=new E(i,s).build();return new p(t,d,!0)}addPreviousNextButtons(){if(this._slideshow.getImageViewer().getNumberOfImages()>1){const{previousButton:e,nextButton:s}=this._createPreviousNextButtons();this._setupHoverEvents([e,s])}return this}addFullscreen(e){if(this._fullscreen=new L(this._slideshowContainerElement),e&&(T(e),e.backgroundColor&&this._fullscreen.setBackgroundColor(e.backgroundColor),e.useAverageBackgroundColor)){const t=new x,n=this._slideshow.getImageViewer();n.addImageChangedCallback((i,d)=>{var r;if((r=this._fullscreen)!=null&&r.isActive()){const y=t.getColor(n.getImageElement(i),{algorithm:"sqrt",silent:!0});this._fullscreen.setBackgroundColor(y.rgb)}}),this._fullscreen.addChangedCallback(i=>{var d;if(i){const r=t.getColor(n.getImageElement(n.getImageIndex()),{algorithm:"sqrt"});(d=this._fullscreen)==null||d.setBackgroundColor(r.rgb)}})}const s=this._createFullscreenButton();return this._setupHoverEvents([s]),this._setupFullscreenKeyEvents(this._fullscreen),this._setupFullscreenClickEvent(this._fullscreen,s),this._setupFullscreenChangedHandler(this._fullscreen,s),this._fullScreenOnly&&this._fullscreen.addChangedCallback(t=>{t?f(this._slideshowContainerElement,"display"):o(this._slideshowContainerElement,"display","none")}),this}addThumbScroller(e,s,t){return this._thumbsViewer=new N(e,s,t,n=>{this._slideshow.getLoader().setCurrentIndex(n),this._slideshow.getImageViewer().showImage(n)}).addPreviousNextButtons().build(),this._slideshow.getImageViewer().addImageChangedCallback((n,i)=>{this._thumbsViewer.setCenterThumb(n,!0)}),this}build(){return this._slideshow.getImageViewer().getNumberOfImages()>1&&(this._setupSwipeHandler(this._slideshow.getImageViewer()),this._setupKeyEvents(this._slideshow.getImageViewer())),new V(this._slideshow.getImageViewer(),this._slideshow.getLoader(),this._thumbsViewer,this._fullscreen)}_createPreviousNextButtons(){const e=m("div");_(e,b),a(e,g.gallery__previous_btn),a(e,w.fade),S(e,this._slideshowContainerElement);const s=m("div");return _(s,b),a(s,g.gallery__next_btn),a(s,w.fade),u(s,this._slideshowContainerElement),{previousButton:e,nextButton:s}}_setupSwipeHandler(e){o(this._slideshowContainerElement,"touch-action","pinch-zoom pan-y"),new O(this._slideshowContainerElement,(s,t)=>{const n=P(this._slideshowContainerElement).width,i=H(this._slideshowContainerElement).x;s===I.LEFT?e.showPreviousImage(s):s===I.RIGHT?e.showNextImage(s):t.x-i>n/2?e.showNextImage():e.showPreviousImage()})}_setupHoverEvents(e){c(this._slideshowContainerElement,"mouseenter",()=>{e.forEach(s=>{o(s,"opacity",`${q}`)})}),c(this._slideshowContainerElement,"mouseleave",()=>{e.forEach(s=>{o(s,"opacity","0")})})}_setupKeyEvents(e){C(s=>{switch(v(s)){case"ArrowRight":e.showNextImage();break;case"ArrowLeft":e.showPreviousImage();break}})}_setupFullscreenKeyEvents(e){C(s=>{switch(v(s)){case"Escape":e.deActivate();break;case"f":e.isActive()?e.deActivate():e.activate();break}})}_createFullscreenButton(){const e=m("div");return _(e,K),a(e,g.gallery__fullscreen_btn),a(e,w.fade),u(e,this._slideshowContainerElement),e}_setupFullscreenClickEvent(e,s){c(s,"pointerdown",t=>{t.stopPropagation()}),c(s,"pointerup",t=>{t.stopPropagation(),e.isActive()||(e.activate(),o(s,"display","none"))})}_setupFullscreenChangedHandler(e,s){e.addChangedCallback(t=>{t?o(s,"display","none"):f(s,"display")})}}export{p as default};
