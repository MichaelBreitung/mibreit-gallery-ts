var w=Object.defineProperty;var E=(n,t,e)=>t in n?w(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>E(n,typeof t!="symbol"?t+"":t,e);import y from"../containers/GalleryContainer.js";import b from"../containers/SlideshowContainer.js";import S from"../containers/ThumbScrollerContainer.js";import g from"../containers/FullscreenContainer.js";import{createElement as c,setInnerHtml as _,addCssClass as l,prependChildElement as F,appendChildElement as p,addCssStyle as a,getElementDimension as B,getElementPosition as I,addResizeEventListener as v,addEventListener as u,addKeyEventListener as H,removeCssStyle as x,getKeyFromEvent as k}from"../node_modules/mibreit-dom-tools/lib/index.js";import f from"../images/nextImage.svg.js";import z from"../images/fullscreen.svg.js";import d from"./GalleryContainerBuilder.module.css.js";import m from"../tools/animations.module.css.js";import{GALLERY_BUTTONS_SHOW_OPACITY as P}from"../constants.js";import A,{ESwipeDirection as C}from"../components/SwipeHandler.js";import G from"../tools/debounce.js";const T=500;class j{constructor(t,e,i){r(this,"_container");r(this,"_fullscreenButton",null);r(this,"_viewer");r(this,"_loader");r(this,"_thumbScroller",null);r(this,"_fullscreenContainer",null);this._container=t;const s=new b(e,i);this._viewer=s.getViewer(),this._loader=s.getLoader();const{previousButton:o,nextButton:h}=this._createPreviousNextButtons(t);this._setupHoverEvents(t,[o,h]),this._setupSwipeHandler(t,this._viewer)}addThumbScroller(t,e,i){return this._thumbScroller=new S(t,e,i,s=>{this._loader.setCurrentIndex(s),this._viewer.showImage(s)}).getScroller(),this._thumbScroller&&this._viewer.addImageChangedCallback((s,o)=>{this._thumbScroller.scrollTo(s,!0)}),this}build(){return this._fullscreenContainer=new g(this._container),this._fullscreenButton=this._createFullscreenButton(this._container),this._setupHoverEvents(this._container,[this._fullscreenButton]),this._setupKeyEvents(this._viewer,this._fullscreenContainer),this._setupFullscreenClickEvent(this._fullscreenButton,this._fullscreenContainer,this._viewer),this._setupResizeHandler(this._viewer,this._thumbScroller),this._fullscreenContainer&&this._fullscreenButton&&this._setupFullscreenChangedHandler(this._fullscreenContainer,this._fullscreenButton,this._viewer,this._thumbScroller),new y(this._viewer,this._loader,this._thumbScroller,this._fullscreenContainer)}_createPreviousNextButtons(t){const e=c("div");_(e,f),l(e,d.mibreit_GalleryPrevious),l(e,m.mibreit_GalleryFade),F(e,t);const i=c("div");return _(i,f),l(i,d.mibreit_GalleryNext),l(i,m.mibreit_GalleryFade),p(i,t),{previousButton:e,nextButton:i}}_setupSwipeHandler(t,e){a(t,"touch-action","pinch-zoom pan-y"),new A(t,(i,s)=>{const o=B(t).width,h=I(t).x;i===C.LEFT?e.showPreviousImage(i):i===C.RIGHT?e.showNextImage(i):s.x-h>o/2?e.showNextImage():e.showPreviousImage()})}_setupResizeHandler(t,e){if(e){const i=G(()=>{e.reinitSize()},T,!1);v(()=>{t.reinitSize(),i()})}else v(()=>{t.reinitSize()})}_createFullscreenButton(t){const e=c("div");return _(e,z),l(e,d.mibreit_GalleryFullscreenButton),l(e,m.mibreit_GalleryFade),p(e,t),e}_setupHoverEvents(t,e){u(t,"mouseenter",()=>{e.forEach(i=>{a(i,"opacity",`${P}`)})}),u(t,"mouseleave",()=>{e.forEach(i=>{a(i,"opacity","0")})})}_setupKeyEvents(t,e){H(i=>{switch(k(i)){case"ArrowRight":t.showNextImage();break;case"ArrowLeft":t.showPreviousImage();break;case"Escape":e.deActivate();break;case"f":e.isFullscreenActive()?e.deActivate():e.activate();break;default:e.isFullscreenActive()&&e.deActivate();break}})}_setupFullscreenClickEvent(t,e,i){u(t,"pointerdown",s=>{s.stopPropagation()}),u(t,"pointerup",s=>{s.stopPropagation(),e.isFullscreenActive()||(e.activate(),i.reinitSize(),a(t,"display","none"))})}_setupFullscreenChangedHandler(t,e,i,s){t.addFullscreenChangedCallback(o=>{s&&s.reinitSize(),i.reinitSize(),o?a(e,"display","none"):x(e,"display")})}}export{j as default};
