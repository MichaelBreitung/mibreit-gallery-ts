var C=Object.defineProperty;var y=(r,e,t)=>e in r?C(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var n=(r,e,t)=>y(r,typeof e!="symbol"?e+"":e,t);import{createElement as m,setInnerHtml as _,addCssClass as o,prependChildElement as E,appendChildElement as p,addCssStyle as a,getElementDimension as b,getElementPosition as F,addResizeEventListener as I,addEventListener as h,addKeyEventListener as w,removeCssStyle as V,getKeyFromEvent as v}from"../node_modules/mibreit-dom-tools/lib/index.js";import H from"../containers/GalleryContainer.js";import k from"../containers/FullscreenContainer.js";import x from"../containers/SlideshowContainer.js";import L from"../containers/ThumbScrollerContainer.js";import T,{ESwipeDirection as f}from"../components/SwipeHandler.js";import g from"../images/nextImage.svg.js";import P from"../images/fullscreen.svg.js";import d from"./GalleryContainerBuilder.module.css.js";import c from"../tools/animations.module.css.js";import{GALLERY_BUTTONS_SHOW_OPACITY as S}from"../constants.js";class X{constructor(e,t,s){n(this,"_slideshowContainerElement");n(this,"_imageViewer");n(this,"_lazyLoader");n(this,"_thumbsViewer",null);n(this,"_fullscreenContainer",null);this._slideshowContainerElement=e;const i=new x(t,s);this._imageViewer=i.getImageViewer(),this._lazyLoader=i.getLoader();const{previousButton:l,nextButton:u}=this._createPreviousNextButtons(e);this._setupHoverEvents(e,[l,u]),this._setupSwipeHandler(e,this._imageViewer),this._setupKeyEvents(this._imageViewer)}addFullscreen(){this._fullscreenContainer=new k(this._slideshowContainerElement);const e=this._createFullscreenButton(this._slideshowContainerElement);this._setupHoverEvents(this._slideshowContainerElement,[e]),this._setupFullscreenKeyEvents(this._fullscreenContainer),this._setupFullscreenClickEvent(e,this._fullscreenContainer),this._fullscreenContainer&&e&&this._setupFullscreenChangedHandler(this._fullscreenContainer,e,this._thumbsViewer)}addThumbScroller(e,t,s){return this._thumbsViewer=new L(e,t,s,i=>{this._lazyLoader.setCurrentIndex(i),this._imageViewer.showImage(i)}).getThumbsViewer(),this._thumbsViewer&&(this._setupThumbsViewerResizeHandler(this._thumbsViewer),this._imageViewer.addImageChangedCallback((i,l)=>{this._thumbsViewer.setCenterThumb(i,!0)})),this}build(){return new H(this._imageViewer,this._lazyLoader,this._thumbsViewer,this._fullscreenContainer)}_createPreviousNextButtons(e){const t=m("div");_(t,g),o(t,d.gallery__previous_btn),o(t,c.fade),E(t,e);const s=m("div");return _(s,g),o(s,d.gallery__next_btn),o(s,c.fade),p(s,e),{previousButton:t,nextButton:s}}_setupSwipeHandler(e,t){a(e,"touch-action","pinch-zoom pan-y"),new T(e,(s,i)=>{const l=b(e).width,u=F(e).x;s===f.LEFT?t.showPreviousImage(s):s===f.RIGHT?t.showNextImage(s):i.x-u>l/2?t.showNextImage():t.showPreviousImage()})}_setupThumbsViewerResizeHandler(e){I(()=>{})}_setupHoverEvents(e,t){h(e,"mouseenter",()=>{t.forEach(s=>{a(s,"opacity",`${S}`)})}),h(e,"mouseleave",()=>{t.forEach(s=>{a(s,"opacity","0")})})}_setupKeyEvents(e){w(t=>{switch(v(t)){case"ArrowRight":e.showNextImage();break;case"ArrowLeft":e.showPreviousImage();break}})}_setupFullscreenKeyEvents(e){w(t=>{switch(v(t)){case"Escape":e.deActivate();break;case"f":e.isFullscreenActive()?e.deActivate():e.activate();break}})}_createFullscreenButton(e){const t=m("div");return _(t,P),o(t,d.gallery__fullscreen_btn),o(t,c.fade),p(t,e),t}_setupFullscreenClickEvent(e,t){h(e,"pointerdown",s=>{s.stopPropagation()}),h(e,"pointerup",s=>{s.stopPropagation(),t.isFullscreenActive()||(t.activate(),a(e,"display","none"))})}_setupFullscreenChangedHandler(e,t,s){e.addFullscreenChangedCallback(i=>{s&&s.reinitSize(),i?a(t,"display","none"):V(t,"display")})}}export{X as default};
