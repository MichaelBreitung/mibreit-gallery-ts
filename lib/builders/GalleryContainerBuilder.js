var g=Object.defineProperty;var C=(n,t,e)=>t in n?g(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>C(n,typeof t!="symbol"?t+"":t,e);import E from"../containers/GalleryContainer.js";import b from"../containers/SlideshowContainer.js";import y from"../containers/ThumbScrollerContainer.js";import I from"../containers/FullscreenContainer.js";import{createElement as _,setInnerHtml as m,addCssClass as a,prependChildElement as B,appendChildElement as p,addCssStyle as l,getElementDimension as V,getElementPosition as F,addResizeEventListener as f,addEventListener as u,addKeyEventListener as H,removeCssStyle as S,getKeyFromEvent as x}from"../node_modules/mibreit-dom-tools/lib/index.js";import v from"../images/nextImage.svg.js";import k from"../images/fullscreen.svg.js";import c from"./GalleryContainerBuilder.module.css.js";import d from"../tools/animations.module.css.js";import{GALLERY_BUTTONS_SHOW_OPACITY as z}from"../constants.js";import T,{ESwipeDirection as w}from"../components/SwipeHandler.js";import A from"../tools/debounce.js";const P=500;class ${constructor(t,e,i){r(this,"_container");r(this,"_fullscreenButton",null);r(this,"_imageViewer");r(this,"_loader");r(this,"_thumbsViewer",null);r(this,"_fullscreenContainer",null);this._container=t;const s=new b(e,i);this._imageViewer=s.getImageViewer(),this._loader=s.getLoader();const{previousButton:o,nextButton:h}=this._createPreviousNextButtons(t);this._setupHoverEvents(t,[o,h]),this._setupSwipeHandler(t,this._imageViewer)}addThumbScroller(t,e,i){return this._thumbsViewer=new y(t,e,i,s=>{this._loader.setCurrentIndex(s),this._imageViewer.showImage(s)}).getThumbsViewer(),this._thumbsViewer&&this._imageViewer.addImageChangedCallback((s,o)=>{this._thumbsViewer.setCenterThumb(s,!0)}),this}build(){return this._fullscreenContainer=new I(this._container),this._fullscreenButton=this._createFullscreenButton(this._container),this._setupHoverEvents(this._container,[this._fullscreenButton]),this._setupKeyEvents(this._imageViewer,this._fullscreenContainer),this._setupFullscreenClickEvent(this._fullscreenButton,this._fullscreenContainer,this._imageViewer),this._setupResizeHandler(this._imageViewer,this._thumbsViewer),this._fullscreenContainer&&this._fullscreenButton&&this._setupFullscreenChangedHandler(this._fullscreenContainer,this._fullscreenButton,this._imageViewer,this._thumbsViewer),new E(this._imageViewer,this._loader,this._thumbsViewer,this._fullscreenContainer)}_createPreviousNextButtons(t){const e=_("div");m(e,v),a(e,c.gallery__previous_btn),a(e,d.fade),B(e,t);const i=_("div");return m(i,v),a(i,c.gallery__next_btn),a(i,d.fade),p(i,t),{previousButton:e,nextButton:i}}_setupSwipeHandler(t,e){l(t,"touch-action","pinch-zoom pan-y"),new T(t,(i,s)=>{const o=V(t).width,h=F(t).x;i===w.LEFT?e.showPreviousImage(i):i===w.RIGHT?e.showNextImage(i):s.x-h>o/2?e.showNextImage():e.showPreviousImage()})}_setupResizeHandler(t,e){if(e){const i=A(()=>{e.reinitSize()},P,!1);f(()=>{t.reinitSize(),i()})}else f(()=>{t.reinitSize()})}_createFullscreenButton(t){const e=_("div");return m(e,k),a(e,c.gallery__fullscreen_btn),a(e,d.fade),p(e,t),e}_setupHoverEvents(t,e){u(t,"mouseenter",()=>{e.forEach(i=>{l(i,"opacity",`${z}`)})}),u(t,"mouseleave",()=>{e.forEach(i=>{l(i,"opacity","0")})})}_setupKeyEvents(t,e){H(i=>{switch(x(i)){case"ArrowRight":t.showNextImage();break;case"ArrowLeft":t.showPreviousImage();break;case"Escape":e.deActivate();break;case"f":e.isFullscreenActive()?e.deActivate():e.activate();break;default:e.isFullscreenActive()&&e.deActivate();break}})}_setupFullscreenClickEvent(t,e,i){u(t,"pointerdown",s=>{s.stopPropagation()}),u(t,"pointerup",s=>{s.stopPropagation(),e.isFullscreenActive()||(e.activate(),i.reinitSize(),l(t,"display","none"))})}_setupFullscreenChangedHandler(t,e,i,s){t.addFullscreenChangedCallback(o=>{s&&s.reinitSize(),i.reinitSize(),o?l(e,"display","none"):S(e,"display")})}}export{$ as default};
