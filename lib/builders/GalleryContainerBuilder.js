var w=Object.defineProperty;var g=(n,t,e)=>t in n?w(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>g(n,typeof t!="symbol"?t+"":t,e);import C from"../containers/GalleryContainer.js";import E from"../containers/SlideshowContainer.js";import y from"../containers/ThumbScrollerContainer.js";import b from"../containers/FullscreenContainer.js";import{createElement as _,setInnerHtml as m,addCssClass as o,prependChildElement as I,appendChildElement as p,addCssStyle as a,getElementDimension as B,getElementPosition as F,addResizeEventListener as H,addEventListener as u,addKeyEventListener as x,removeCssStyle as V,getKeyFromEvent as k}from"../node_modules/mibreit-dom-tools/lib/index.js";import f from"../images/nextImage.svg.js";import A from"../images/fullscreen.svg.js";import c from"./GalleryContainerBuilder.module.css.js";import d from"../tools/animations.module.css.js";import{GALLERY_BUTTONS_SHOW_OPACITY as P}from"../constants.js";import T,{ESwipeDirection as v}from"../components/SwipeHandler.js";class X{constructor(t,e,s){r(this,"_container");r(this,"_fullscreenButton",null);r(this,"_imageViewer");r(this,"_loader");r(this,"_thumbsViewer",null);r(this,"_fullscreenContainer",null);this._container=t;const i=new E(e,s);this._imageViewer=i.getImageViewer(),this._loader=i.getLoader();const{previousButton:l,nextButton:h}=this._createPreviousNextButtons(t);this._setupHoverEvents(t,[l,h]),this._setupSwipeHandler(t,this._imageViewer)}addThumbScroller(t,e,s){return this._thumbsViewer=new y(t,e,s,i=>{this._loader.setCurrentIndex(i),this._imageViewer.showImage(i)}).getThumbsViewer(),this._thumbsViewer&&this._imageViewer.addImageChangedCallback((i,l)=>{this._thumbsViewer.setCenterThumb(i,!0)}),this}build(){return this._fullscreenContainer=new b(this._container),this._fullscreenButton=this._createFullscreenButton(this._container),this._setupHoverEvents(this._container,[this._fullscreenButton]),this._setupKeyEvents(this._imageViewer,this._fullscreenContainer),this._setupFullscreenClickEvent(this._fullscreenButton,this._fullscreenContainer),this._setupResizeHandler(this._thumbsViewer),this._fullscreenContainer&&this._fullscreenButton&&this._setupFullscreenChangedHandler(this._fullscreenContainer,this._fullscreenButton,this._thumbsViewer),new C(this._imageViewer,this._loader,this._thumbsViewer,this._fullscreenContainer)}_createPreviousNextButtons(t){const e=_("div");m(e,f),o(e,c.gallery__previous_btn),o(e,d.fade),I(e,t);const s=_("div");return m(s,f),o(s,c.gallery__next_btn),o(s,d.fade),p(s,t),{previousButton:e,nextButton:s}}_setupSwipeHandler(t,e){a(t,"touch-action","pinch-zoom pan-y"),new T(t,(s,i)=>{const l=B(t).width,h=F(t).x;s===v.LEFT?e.showPreviousImage(s):s===v.RIGHT?e.showNextImage(s):i.x-h>l/2?e.showNextImage():e.showPreviousImage()})}_setupResizeHandler(t){t&&H(()=>{})}_createFullscreenButton(t){const e=_("div");return m(e,A),o(e,c.gallery__fullscreen_btn),o(e,d.fade),p(e,t),e}_setupHoverEvents(t,e){u(t,"mouseenter",()=>{e.forEach(s=>{a(s,"opacity",`${P}`)})}),u(t,"mouseleave",()=>{e.forEach(s=>{a(s,"opacity","0")})})}_setupKeyEvents(t,e){x(s=>{switch(k(s)){case"ArrowRight":t.showNextImage();break;case"ArrowLeft":t.showPreviousImage();break;case"Escape":e.deActivate();break;case"f":e.isFullscreenActive()?e.deActivate():e.activate();break;default:e.isFullscreenActive()&&e.deActivate();break}})}_setupFullscreenClickEvent(t,e){u(t,"pointerdown",s=>{s.stopPropagation()}),u(t,"pointerup",s=>{s.stopPropagation(),e.isFullscreenActive()||(e.activate(),a(t,"display","none"))})}_setupFullscreenChangedHandler(t,e,s){t.addFullscreenChangedCallback(i=>{s&&s.reinitSize(),i?a(e,"display","none"):V(e,"display")})}}export{X as default};
