{"version":3,"file":"ImageViewer.js","sources":["../../src/components/ImageViewer.ts"],"sourcesContent":["/**\r\n * @author Michael Breitung\r\n * @copyright Michael Breitung Photography (www.mibreit-photo.com)\r\n */\r\n\r\nimport createImageStage, { EImageScaleMode } from '../factories/createImageStage';\r\nimport Image from './Image';\r\n\r\n// interfaces\r\nimport IImageViewer from '../interfaces/IImageViewer';\r\nimport IImageStage from '../interfaces/IImageStage';\r\nimport IImageInfo from '../interfaces/IImageInfo';\r\n\r\n// types\r\nimport { ESwipeDirection } from './SwipeHandler';\r\n\r\nexport default class ImageViewer implements IImageViewer {\r\n  private _currentIndex: number = -1;\r\n  private _imageStages: Array<IImageStage> = [];\r\n  private _images: Array<Image>;\r\n  private _imageChangedCallbacks: Array<(index: number, imageInfo: IImageInfo) => void> = new Array();\r\n\r\n  constructor(images: Array<Image>, scaleMode: EImageScaleMode = EImageScaleMode.FIT_ASPECT) {\r\n    this._images = images;\r\n    this._prepareImageStages(images, scaleMode);\r\n  }\r\n\r\n  showImage(index: number): boolean {\r\n    return this._showImage(index);\r\n  }\r\n\r\n  showNextImage(swipeDirection?: ESwipeDirection): boolean {\r\n    const newIndex = this._currentIndex < this._imageStages.length - 1 ? this._currentIndex + 1 : 0;\r\n    return this._showImage(newIndex, swipeDirection);\r\n  }\r\n\r\n  showPreviousImage(swipeDirection?: ESwipeDirection): boolean {\r\n    const newIndex = this._currentIndex > 0 ? this._currentIndex - 1 : this._imageStages.length - 1;\r\n    return this._showImage(newIndex, swipeDirection);\r\n  }\r\n\r\n  getNumberOfImages(): number {\r\n    return this._imageStages.length;\r\n  }\r\n\r\n  reinitSize(): void {\r\n    if (this._isValidIndex(this._currentIndex)) {\r\n      this._imageStages[this._currentIndex]!.applyScaleMode();\r\n    }\r\n  }\r\n\r\n  setZoomAnimation(active: boolean): void {\r\n    this._imageStages.forEach((stage) => {\r\n      stage.setZoomAnimation(active);\r\n    });\r\n  }\r\n\r\n  addImageChangedCallback(callback: (index: number, imageInfo: IImageInfo) => void) {\r\n    if (!this._imageChangedCallbacks.includes(callback)) {\r\n      this._imageChangedCallbacks.push(callback);\r\n    }\r\n  }\r\n\r\n  getImageIndex(): number {\r\n    return this._currentIndex;\r\n  }\r\n\r\n  getImageInfo(index: number): IImageInfo | null {\r\n    if (this._isValidIndex(index)) {\r\n      return this._images[index]!;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  getImageElement(index: number): HTMLElement | null {\r\n    if (this._isValidIndex(index)) {\r\n      return this._images[index]!.getHtmlElement();\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private _showImage(index: number, swipeDirection: ESwipeDirection = ESwipeDirection.NONE): boolean {\r\n    if (this._isValidIndex(index)) {\r\n      if (index != this._currentIndex) {\r\n        if (!this._images[index]!.wasLoaded()) {\r\n          this._images[index]!.addWasLoadedCallback(() => {\r\n            this._hideImage(this._currentIndex, swipeDirection);\r\n            this._changeCurrentImage(index, swipeDirection);\r\n          });\r\n        } else {\r\n          this._hideImage(this._currentIndex, swipeDirection);\r\n          this._changeCurrentImage(index, swipeDirection);\r\n        }\r\n      }\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private _hideImage(index: number, swipeDirection: ESwipeDirection = ESwipeDirection.NONE) {\r\n    if (this._isValidIndex(index)) {\r\n      this._imageStages[this._currentIndex]!.hideImage(swipeDirection);\r\n    }\r\n  }\r\n\r\n  private _prepareImageStages(images: Array<Image>, scaleMode: EImageScaleMode) {\r\n    images.forEach((image) => {\r\n      const imageStage = createImageStage(image.getHtmlElement(), image.getWidth(), image.getHeight(), scaleMode);\r\n      image.addWasLoadedCallback(() => {\r\n        imageStage.applyScaleMode();\r\n      });\r\n      this._imageStages.push(imageStage);\r\n    });\r\n  }\r\n\r\n  private _isValidIndex(index: number) {\r\n    return index >= 0 && index < this._imageStages.length;\r\n  }\r\n\r\n  private _changeCurrentImage(index: number, swipeDirection: ESwipeDirection = ESwipeDirection.NONE) {\r\n    console.log('ImageViewer#changeCurrentImage', index);\r\n    this._currentIndex = index;\r\n    this._imageStages[this._currentIndex]!.showImage(swipeDirection);\r\n    this._imageChangedCallbacks.forEach((callback) => {\r\n      callback(this._currentIndex, this._images[this._currentIndex]!);\r\n    });\r\n  }\r\n}\r\n"],"names":["ImageViewer","images","scaleMode","EImageScaleMode","__publicField","index","swipeDirection","newIndex","active","stage","callback","ESwipeDirection","image","imageStage","createImageStage"],"mappings":"8RAgBA,MAAqBA,CAAoC,CAMvD,YAAYC,EAAsBC,EAA6BC,EAAgB,WAAY,CALnFC,EAAA,qBAAwB,IACxBA,EAAA,oBAAmC,CAAA,GACnCA,EAAA,gBACAA,EAAA,8BAAgF,IAAI,OAG1F,KAAK,QAAUH,EACV,KAAA,oBAAoBA,EAAQC,CAAS,CAC5C,CAEA,UAAUG,EAAwB,CACzB,OAAA,KAAK,WAAWA,CAAK,CAC9B,CAEA,cAAcC,EAA2C,CACjD,MAAAC,EAAW,KAAK,cAAgB,KAAK,aAAa,OAAS,EAAI,KAAK,cAAgB,EAAI,EACvF,OAAA,KAAK,WAAWA,EAAUD,CAAc,CACjD,CAEA,kBAAkBA,EAA2C,CACrD,MAAAC,EAAW,KAAK,cAAgB,EAAI,KAAK,cAAgB,EAAI,KAAK,aAAa,OAAS,EACvF,OAAA,KAAK,WAAWA,EAAUD,CAAc,CACjD,CAEA,mBAA4B,CAC1B,OAAO,KAAK,aAAa,MAC3B,CAEA,YAAmB,CACb,KAAK,cAAc,KAAK,aAAa,GACvC,KAAK,aAAa,KAAK,aAAa,EAAG,eAAe,CAE1D,CAEA,iBAAiBE,EAAuB,CACjC,KAAA,aAAa,QAASC,GAAU,CACnCA,EAAM,iBAAiBD,CAAM,CAAA,CAC9B,CACH,CAEA,wBAAwBE,EAA0D,CAC3E,KAAK,uBAAuB,SAASA,CAAQ,GAC3C,KAAA,uBAAuB,KAAKA,CAAQ,CAE7C,CAEA,eAAwB,CACtB,OAAO,KAAK,aACd,CAEA,aAAaL,EAAkC,CACzC,OAAA,KAAK,cAAcA,CAAK,EACnB,KAAK,QAAQA,CAAK,EAElB,IAEX,CAEA,gBAAgBA,EAAmC,CAC7C,OAAA,KAAK,cAAcA,CAAK,EACnB,KAAK,QAAQA,CAAK,EAAG,eAAe,EAEpC,IAEX,CAEQ,WAAWA,EAAeC,EAAkCK,EAAgB,KAAe,CAC7F,OAAA,KAAK,cAAcN,CAAK,GACtBA,GAAS,KAAK,gBACX,KAAK,QAAQA,CAAK,EAAG,aAMnB,KAAA,WAAW,KAAK,cAAeC,CAAc,EAC7C,KAAA,oBAAoBD,EAAOC,CAAc,GAN9C,KAAK,QAAQD,CAAK,EAAG,qBAAqB,IAAM,CACzC,KAAA,WAAW,KAAK,cAAeC,CAAc,EAC7C,KAAA,oBAAoBD,EAAOC,CAAc,CAAA,CAC/C,GAME,IAEA,EAEX,CAEQ,WAAWD,EAAeC,EAAkCK,EAAgB,KAAM,CACpF,KAAK,cAAcN,CAAK,GAC1B,KAAK,aAAa,KAAK,aAAa,EAAG,UAAUC,CAAc,CAEnE,CAEQ,oBAAoBL,EAAsBC,EAA4B,CACrED,EAAA,QAASW,GAAU,CAClB,MAAAC,EAAaC,EAAiBF,EAAM,eAAe,EAAGA,EAAM,SAAA,EAAYA,EAAM,UAAU,EAAGV,CAAS,EAC1GU,EAAM,qBAAqB,IAAM,CAC/BC,EAAW,eAAe,CAAA,CAC3B,EACI,KAAA,aAAa,KAAKA,CAAU,CAAA,CAClC,CACH,CAEQ,cAAcR,EAAe,CACnC,OAAOA,GAAS,GAAKA,EAAQ,KAAK,aAAa,MACjD,CAEQ,oBAAoBA,EAAeC,EAAkCK,EAAgB,KAAM,CAEjG,KAAK,cAAgBN,EACrB,KAAK,aAAa,KAAK,aAAa,EAAG,UAAUC,CAAc,EAC1D,KAAA,uBAAuB,QAASI,GAAa,CAChDA,EAAS,KAAK,cAAe,KAAK,QAAQ,KAAK,aAAa,CAAE,CAAA,CAC/D,CACH,CACF"}