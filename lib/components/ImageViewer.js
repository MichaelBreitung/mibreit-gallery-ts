var m=Object.defineProperty;var _=(r,e,t)=>e in r?m(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var s=(r,e,t)=>_(r,typeof e!="symbol"?e+"":e,t);import{addCssClass as d,removeCssClass as I}from"../node_modules/mibreit-dom-tools/lib/index.js";import l from"./ImageStageFitAspect.js";import o from"./ImageStageExpand.js";import u from"./ImageStageStretch.js";import c from"./ImageStageNoScale.js";import{ESwipeDirection as h}from"./SwipeHandler.js";import{EImageScaleMode as n}from"../types/index.js";import g from"./ImageViewer.module.css.js";class y{constructor(e,t,a=n.FIT_ASPECT){s(this,"_currentIndex",-1);s(this,"_delayedNewIndex",-1);s(this,"_imageStages",[]);s(this,"_images");s(this,"_lazyLoader");s(this,"_imageChangedCallbacks",new Array);this._images=e,e.forEach(i=>{d(i.getHtmlElement(),g.hidden)}),this._lazyLoader=t,this._prepareImageStages(e,a)}showImage(e){return this._showImage(e)}showNextImage(e){const t=this._currentIndex<this._imageStages.length-1?this._currentIndex+1:0;return this._showImage(t,e)}showPreviousImage(e){const t=this._currentIndex>0?this._currentIndex-1:this._imageStages.length-1;return this._showImage(t,e)}getNumberOfImages(){return this._imageStages.length}setZoomAnimation(e){this._imageStages.forEach(t=>{t.setZoomAnimation(e)})}setSkewAnimation(e){this._imageStages.forEach(t=>{t.setSkewAnimation(e)})}addImageChangedCallback(e){this._imageChangedCallbacks.includes(e)||this._imageChangedCallbacks.push(e)}getImageIndex(){return this._currentIndex}getImageInfo(e){return this._isValidIndex(e)?this._images[e]:null}getImageElement(e){return this._isValidIndex(e)?this._images[e].getHtmlElement():null}_showImage(e,t=h.NONE){return this._isValidIndex(e)?(e!=this._currentIndex&&(I(this._images[e].getHtmlElement(),g.hidden),this._lazyLoader.setCurrentIndex(e),this._images[e].wasLoaded()?(this._hideImage(this._currentIndex,t),this._changeCurrentImage(e,t)):(this._delayedNewIndex=e,this._images[e].addWasLoadedCallback(()=>{e===this._delayedNewIndex&&(this._hideImage(this._currentIndex,t),this._changeCurrentImage(this._delayedNewIndex,t))}))),!0):!1}_hideImage(e,t=h.NONE){this._isValidIndex(e)&&this._imageStages[this._currentIndex].hideImage(t)}_prepareImageStages(e,t){e.forEach(a=>{const i=this._createImageStage(a.getHtmlElement(),a.getWidth(),a.getHeight(),t);a.addWasLoadedCallback(()=>{i.reinitSize()}),this._imageStages.push(i)})}_createImageStage(e,t,a,i=n.FIT_ASPECT){switch(i){case n.EXPAND:return new o(e,t,a);case n.FIT_ASPECT:return new l(e,t,a);case n.STRETCH:return new u(e);case n.NONE:default:return new c(e)}}_isValidIndex(e){return e>=0&&e<this._imageStages.length}_changeCurrentImage(e,t=h.NONE){this._currentIndex=e,this._imageStages[this._currentIndex].showImage(t),this._imageChangedCallbacks.forEach(a=>{a(this._currentIndex,this._images[this._currentIndex])})}}export{y as default};
