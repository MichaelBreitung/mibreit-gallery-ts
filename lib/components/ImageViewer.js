var h=Object.defineProperty;var m=(r,e,t)=>e in r?h(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var s=(r,e,t)=>m(r,typeof e!="symbol"?e+"":e,t);import _ from"./ImageStageFitAspect.js";import I from"./ImageStageExpand.js";import d from"./ImageStageStretch.js";import l from"./ImageStageNoScale.js";import{ESwipeDirection as g}from"./SwipeHandler.js";import{EImageScaleMode as i}from"../types/index.js";class C{constructor(e,t,a=i.FIT_ASPECT){s(this,"_currentIndex",-1);s(this,"_delayedNewIndex",-1);s(this,"_imageStages",[]);s(this,"_images");s(this,"_lazyLoader");s(this,"_imageChangedCallbacks",new Array);this._images=e,this._lazyLoader=t,this._prepareImageStages(e,a)}showImage(e){return this._showImage(e)}showNextImage(e){const t=this._currentIndex<this._imageStages.length-1?this._currentIndex+1:0;return this._showImage(t,e)}showPreviousImage(e){const t=this._currentIndex>0?this._currentIndex-1:this._imageStages.length-1;return this._showImage(t,e)}getNumberOfImages(){return this._imageStages.length}setZoomAnimation(e){this._imageStages.forEach(t=>{t.setZoomAnimation(e)})}addImageChangedCallback(e){this._imageChangedCallbacks.includes(e)||this._imageChangedCallbacks.push(e)}getImageIndex(){return this._currentIndex}getImageInfo(e){return this._isValidIndex(e)?this._images[e]:null}getImageElement(e){return this._isValidIndex(e)?this._images[e].getHtmlElement():null}_showImage(e,t=g.NONE){return this._isValidIndex(e)?(e!=this._currentIndex&&(this._lazyLoader.setCurrentIndex(e),this._images[e].wasLoaded()?(this._hideImage(this._currentIndex,t),this._changeCurrentImage(e,t)):(this._delayedNewIndex=e,this._images[e].addWasLoadedCallback(()=>{e===this._delayedNewIndex&&(this._hideImage(this._currentIndex,t),this._changeCurrentImage(this._delayedNewIndex,t))}))),!0):!1}_hideImage(e,t=g.NONE){this._isValidIndex(e)&&this._imageStages[this._currentIndex].hideImage(t)}_prepareImageStages(e,t){e.forEach(a=>{const n=this._createImageStage(a.getHtmlElement(),a.getWidth(),a.getHeight(),t);a.addWasLoadedCallback(()=>{n.reinitSize()}),this._imageStages.push(n)})}_createImageStage(e,t,a,n=i.FIT_ASPECT){switch(n){case i.EXPAND:return new I(e,t,a);case i.FIT_ASPECT:return new _(e,t,a);case i.STRETCH:return new d(e);case i.NONE:default:return new l(e)}}_isValidIndex(e){return e>=0&&e<this._imageStages.length}_changeCurrentImage(e,t=g.NONE){this._currentIndex=e,this._imageStages[this._currentIndex].showImage(t),this._imageChangedCallbacks.forEach(a=>{a(this._currentIndex,this._images[this._currentIndex])})}}export{C as default};
