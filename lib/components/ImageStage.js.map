{"version":3,"file":"ImageStage.js","sources":["../../src/components/ImageStage.ts"],"sourcesContent":["/**\r\n * @author Michael Breitung\r\n * @copyright Michael Breitung Photography (www.mibreit-photo.com)\r\n */\r\n\r\nimport {\r\n  TElementDimension,\r\n  addCssClass,\r\n  addCssStyle,\r\n  createElement,\r\n  getComputedCssStyle,\r\n  getElementDimension,\r\n  removeCssClass,\r\n  removeCssStyle,\r\n  wrapElements,\r\n} from 'mibreit-dom-tools';\r\nimport IImageStage from '../interfaces/IImageStage';\r\nimport styles from './ImageStage.module.css';\r\nimport animationStyles from '../tools/animations.module.css';\r\nimport { ESwipeDirection } from './SwipeHandler';\r\nimport { sleepTillNextRenderFinished } from '../tools/AsyncSleep';\r\n\r\n// constants\r\nconst ANIMATIONS_RESET_TIMEOUT = 1000;\r\n\r\n/**\r\n * The ImageStage is responsible for proper scaling and centering\r\n * of images on the stage\r\n */\r\nexport default abstract class ImageStage implements IImageStage {\r\n  private _zoomAnimation: boolean = false;\r\n  protected _imageStage: HTMLElement;\r\n  protected _imageHandle: HTMLElement;\r\n  protected _imageWidth: number;\r\n  protected _imageHeight: number;\r\n\r\n  constructor(imageHandle: HTMLElement, imageWidth: number, imageHeight: number) {\r\n    this._imageHandle = imageHandle;\r\n    this._imageWidth = imageWidth;\r\n    this._imageHeight = imageHeight;\r\n    this._imageStage = this._createStage();\r\n  }\r\n\r\n  setZoomAnimation(activate: boolean): void {\r\n    this._zoomAnimation = activate;\r\n  }\r\n\r\n  applyScaleMode(): void {\r\n    console.log('ImageStage#applyScaleMode');\r\n    const stageDimension: TElementDimension = getElementDimension(this._imageStage);\r\n    this._applyScaleModeImpl(stageDimension.width, stageDimension.height);\r\n    this._centerImage(stageDimension.width, stageDimension.height);\r\n  }\r\n\r\n  setSize(widthCss: string, heightCss: string) {\r\n    addCssStyle(this._imageStage, 'width', widthCss);\r\n    addCssStyle(this._imageStage, 'height', heightCss);\r\n    this.applyScaleMode();\r\n  }\r\n\r\n  setMargin(marginCss: string) {\r\n    addCssStyle(this._imageStage, 'margin', marginCss);\r\n  }\r\n\r\n  async hideImage(swipeDirection: ESwipeDirection = ESwipeDirection.NONE): Promise<void> {\r\n    if (this._zoomAnimation) {\r\n      setTimeout(() => {\r\n        this._resetZoom();\r\n      }, ANIMATIONS_RESET_TIMEOUT);\r\n    }\r\n    this._stopSlideAnimation();\r\n    await sleepTillNextRenderFinished();\r\n    if (swipeDirection == ESwipeDirection.RIGHT) {\r\n      addCssClass(this._imageStage, animationStyles.mibreit_GalleryTransition);\r\n      addCssStyle(this._imageStage, 'left', '-100%');\r\n    } else if (swipeDirection == ESwipeDirection.LEFT) {\r\n      addCssClass(this._imageStage, animationStyles.mibreit_GalleryTransition);\r\n      addCssStyle(this._imageStage, 'left', '100%');\r\n    }\r\n    removeCssStyle(this._imageStage, 'opacity');\r\n  }\r\n\r\n  async showImage(swipeDirection: ESwipeDirection = ESwipeDirection.NONE): Promise<void> {\r\n    this.applyScaleMode();\r\n    if (this._zoomAnimation) {\r\n      this._startZoomAnimation();\r\n    }\r\n    this._stopSlideAnimation();\r\n    await sleepTillNextRenderFinished();\r\n    if (swipeDirection == ESwipeDirection.RIGHT) {\r\n      removeCssClass(this._imageStage, animationStyles.mibreit_GalleryTransition);\r\n      addCssStyle(this._imageStage, 'left', '100%');\r\n      await sleepTillNextRenderFinished();\r\n      addCssClass(this._imageStage, animationStyles.mibreit_GalleryTransition);\r\n      removeCssStyle(this._imageStage, 'left');\r\n    } else if (swipeDirection == ESwipeDirection.LEFT) {\r\n      removeCssClass(this._imageStage, animationStyles.mibreit_GalleryTransition);\r\n      addCssStyle(this._imageStage, 'left', '-100%');\r\n      await sleepTillNextRenderFinished();\r\n      addCssClass(this._imageStage, animationStyles.mibreit_GalleryTransition);\r\n      removeCssStyle(this._imageStage, 'left');\r\n    } else {\r\n      removeCssClass(this._imageStage, animationStyles.mibreit_GalleryTransition);\r\n      removeCssStyle(this._imageStage, 'left');\r\n    }\r\n    addCssStyle(this._imageStage, 'opacity', '1');\r\n  }\r\n\r\n  protected abstract _applyScaleModeImpl(stageWidth: number, stageHeight: number): void;\r\n\r\n  private _createStage(): HTMLElement {\r\n    const wrapper = createElement('div');\r\n    addCssClass(wrapper, styles.mibreit_ImageStage);\r\n    addCssClass(wrapper, animationStyles.mibreit_GalleryFade);\r\n    wrapElements([this._imageHandle], wrapper);\r\n    return wrapper;\r\n  }\r\n\r\n  private _centerImage(stageWidth: number, stageHeight: number) {\r\n    const { width, height } = getElementDimension(this._imageHandle);\r\n    const x: number = (width + stageWidth) / 2.0 - width;\r\n    const y: number = (height + stageHeight) / 2.0 - height;\r\n    addCssStyle(this._imageHandle, 'margin-left', `${x}px`);\r\n    addCssStyle(this._imageHandle, 'margin-top', `${y}px`);\r\n  }\r\n\r\n  private _startZoomAnimation() {\r\n    console.log('ImageStage#startZoomAnimation');\r\n    addCssClass(this._imageHandle, 'zoom');\r\n  }\r\n\r\n  private _resetZoom() {\r\n    console.log('ImageStage#resetZoom');\r\n    removeCssClass(this._imageHandle, 'zoom');\r\n  }\r\n\r\n  private _stopSlideAnimation() {\r\n    addCssStyle(this._imageStage, 'margin-left', getComputedCssStyle(this._imageStage, 'margin-left'));\r\n  }\r\n}\r\n"],"names":["ANIMATIONS_RESET_TIMEOUT","ImageStage","imageHandle","imageWidth","imageHeight","__publicField","activate","stageDimension","getElementDimension","widthCss","heightCss","addCssStyle","marginCss","swipeDirection","ESwipeDirection","sleepTillNextRenderFinished","addCssClass","animationStyles","removeCssStyle","removeCssClass","wrapper","createElement","styles","wrapElements","stageWidth","stageHeight","width","height","x","y","getComputedCssStyle"],"mappings":"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"}