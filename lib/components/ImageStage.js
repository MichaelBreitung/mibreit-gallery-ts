var c=Object.defineProperty;var A=(m,e,t)=>e in m?c(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var g=(m,e,t)=>A(m,typeof e!="symbol"?e+"":e,t);import{getElementDimension as d,addCssClass as s,addCssStyle as i,removeCssStyle as _,removeCssClass as h,createElement as H,wrapElements as y,getComputedCssStyle as z}from"../node_modules/mibreit-dom-tools/lib/index.js";import S from"./ImageStage.module.css.js";import a from"../tools/animations.module.css.js";import{ESwipeDirection as o}from"./SwipeHandler.js";import{sleepTillNextRenderFinished as r}from"../tools/AsyncSleep.js";const E=1e3;class O{constructor(e,t,n){g(this,"_zoomAnimation",!1);g(this,"_imageStage");g(this,"_imageHandle");g(this,"_imageWidth");g(this,"_imageHeight");this._imageHandle=e,this._imageWidth=t,this._imageHeight=n,this._imageStage=this._createStage(),new ResizeObserver(()=>{this.reinitSize()}).observe(this._imageStage)}setZoomAnimation(e){this._zoomAnimation=e}reinitSize(){const e=d(this._imageStage);this._applyScaleModeImpl(e.width,e.height),this._centerImage(e.width,e.height)}async hideImage(e=o.NONE){this._zoomAnimation&&setTimeout(()=>{this._resetZoom()},E),this._stopSlideAnimation(),await r(),e==o.RIGHT?(s(this._imageStage,a.transition),i(this._imageStage,"left","-100%")):e==o.LEFT&&(s(this._imageStage,a.transition),i(this._imageStage,"left","100%")),_(this._imageStage,"opacity")}async showImage(e=o.NONE){this._zoomAnimation&&this._startZoomAnimation(),this._stopSlideAnimation(),await r(),e==o.RIGHT?(h(this._imageStage,a.transition),i(this._imageStage,"left","100%"),await r(),s(this._imageStage,a.transition),_(this._imageStage,"left")):e==o.LEFT?(h(this._imageStage,a.transition),i(this._imageStage,"left","-100%"),await r(),s(this._imageStage,a.transition),_(this._imageStage,"left")):(h(this._imageStage,a.transition),_(this._imageStage,"left")),i(this._imageStage,"opacity","1")}_createStage(){const e=H("div");return s(e,S.img_stage),s(e,a.fade),y([this._imageHandle],e),e}_centerImage(e,t){const{width:n,height:l}=d(this._imageHandle),f=(n+e)/2-n,p=(l+t)/2-l;i(this._imageHandle,"margin-left",`${f}px`),i(this._imageHandle,"margin-top",`${p}px`)}_startZoomAnimation(){s(this._imageHandle,S.img_stage__zoom)}_resetZoom(){h(this._imageHandle,S.img_stage__zoom)}_stopSlideAnimation(){i(this._imageStage,"margin-left",z(this._imageStage,"margin-left"))}}export{O as default};
