var p=Object.defineProperty;var A=(m,e,i)=>e in m?p(m,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[e]=i;var o=(m,e,i)=>A(m,typeof e!="symbol"?e+"":e,i);import{getElementDimension as c,addCssClass as a,addCssStyle as s,removeCssStyle as n,removeCssClass as _,createElement as v,wrapElements as z}from"../node_modules/mibreit-dom-tools/lib/index.js";import h from"./ImageStage.module.css.js";import t from"../tools/animations.module.css.js";import{ESwipeDirection as g}from"./SwipeHandler.js";import{sleepTillNextRenderFinished as r}from"../tools/AsyncSleep.js";const E=1e3;class O{constructor(e){o(this,"_zoomAnimationActive",!1);o(this,"_imageStage");o(this,"_imageHandle");this._imageHandle=e,this._imageStage=this._createStage(),new ResizeObserver(()=>{this.reinitSize()}).observe(this._imageStage)}setZoomAnimation(e){this._zoomAnimationActive=e}reinitSize(){const e=c(this._imageStage);this._applyScaleModeImpl(e.width,e.height),this._centerImage(e.width,e.height)}async hideImage(e=g.NONE){this._zoomAnimationActive&&setTimeout(()=>{this._resetZoom()},E),await r(),e==g.RIGHT?(a(this._imageStage,t.transition),s(this._imageStage,"left","-100%")):e==g.LEFT&&(a(this._imageStage,t.transition),s(this._imageStage,"left","100%")),n(this._imageStage,"opacity")}async showImage(e=g.NONE){this._zoomAnimationActive&&this._startZoomAnimation(),await r(),e==g.RIGHT?(_(this._imageStage,t.transition),s(this._imageStage,"left","100%"),await r(),a(this._imageStage,t.transition),n(this._imageStage,"left")):e==g.LEFT?(_(this._imageStage,t.transition),s(this._imageStage,"left","-100%"),await r(),a(this._imageStage,t.transition),n(this._imageStage,"left")):(_(this._imageStage,t.transition),n(this._imageStage,"left")),s(this._imageStage,"opacity","1")}_createStage(){const e=v("div");return a(e,h.img_stage),a(e,t.fade),z([this._imageHandle],e),e}_centerImage(e,i){const{width:l,height:S}=c(this._imageHandle),d=(l+e)/2-l,f=(S+i)/2-S;s(this._imageHandle,"margin-left",`${d}px`),s(this._imageHandle,"margin-top",`${f}px`)}_startZoomAnimation(){a(this._imageHandle,h.img_stage__zoom)}_resetZoom(){_(this._imageHandle,h.img_stage__zoom)}}export{O as default};
