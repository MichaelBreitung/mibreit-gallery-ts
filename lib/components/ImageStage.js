var p=Object.defineProperty;var c=(m,e,i)=>e in m?p(m,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[e]=i;var o=(m,e,i)=>c(m,typeof e!="symbol"?e+"":e,i);import{getElementDimension as d,addCssStyle as t,addCssClass as s,removeCssStyle as _,removeCssClass as r,createElement as A,wrapElements as H,getComputedCssStyle as w}from"../node_modules/mibreit-dom-tools/lib/index.js";import y from"./ImageStage.module.css.js";import a from"../tools/animations.module.css.js";import{ESwipeDirection as n}from"./SwipeHandler.js";import{sleepTillNextRenderFinished as l}from"../tools/AsyncSleep.js";const E=1e3;class O{constructor(e,i,h){o(this,"_zoomAnimation",!1);o(this,"_imageStage");o(this,"_imageHandle");o(this,"_imageWidth");o(this,"_imageHeight");this._imageHandle=e,this._imageWidth=i,this._imageHeight=h,this._imageStage=this._createStage(),new ResizeObserver(()=>{const g=d(this._imageStage);this._applyScaleModeImpl(g.width,g.height),this._centerImage(g.width,g.height)}).observe(this._imageStage)}setZoomAnimation(e){this._zoomAnimation=e}setSize(e,i){t(this._imageStage,"width",e),t(this._imageStage,"height",i)}setMargin(e){t(this._imageStage,"margin",e)}async hideImage(e=n.NONE){this._zoomAnimation&&setTimeout(()=>{this._resetZoom()},E),this._stopSlideAnimation(),await l(),e==n.RIGHT?(s(this._imageStage,a.transition),t(this._imageStage,"left","-100%")):e==n.LEFT&&(s(this._imageStage,a.transition),t(this._imageStage,"left","100%")),_(this._imageStage,"opacity")}async showImage(e=n.NONE){this._zoomAnimation&&this._startZoomAnimation(),this._stopSlideAnimation(),await l(),e==n.RIGHT?(r(this._imageStage,a.transition),t(this._imageStage,"left","100%"),await l(),s(this._imageStage,a.transition),_(this._imageStage,"left")):e==n.LEFT?(r(this._imageStage,a.transition),t(this._imageStage,"left","-100%"),await l(),s(this._imageStage,a.transition),_(this._imageStage,"left")):(r(this._imageStage,a.transition),_(this._imageStage,"left")),t(this._imageStage,"opacity","1")}_createStage(){const e=A("div");return s(e,y.img_stage),s(e,a.fade),H([this._imageHandle],e),e}_centerImage(e,i){const{width:h,height:S}=d(this._imageHandle),g=(h+e)/2-h,f=(S+i)/2-S;t(this._imageHandle,"margin-left",`${g}px`),t(this._imageHandle,"margin-top",`${f}px`)}_startZoomAnimation(){s(this._imageHandle,"zoom")}_resetZoom(){r(this._imageHandle,"zoom")}_stopSlideAnimation(){t(this._imageStage,"margin-left",w(this._imageStage,"margin-left"))}}export{O as default};
