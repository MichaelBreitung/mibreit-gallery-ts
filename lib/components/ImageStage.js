var c=Object.defineProperty;var A=(m,e,a)=>e in m?c(m,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):m[e]=a;var o=(m,e,a)=>A(m,typeof e!="symbol"?e+"":e,a);import{getElementDimension as d,addCssClass as s,addCssStyle as t,removeCssStyle as n,removeCssClass as _,createElement as y,wrapElements as z,getComputedCssStyle as E}from"../node_modules/mibreit-dom-tools/lib/index.js";import r from"./ImageStage.module.css.js";import i from"../tools/animations.module.css.js";import{ESwipeDirection as g}from"./SwipeHandler.js";import{sleepTillNextRenderFinished as h}from"../tools/AsyncSleep.js";const I=1e3;class O{constructor(e){o(this,"_zoomAnimation",!1);o(this,"_imageStage");o(this,"_imageHandle");this._imageHandle=e,this._imageStage=this._createStage(),new ResizeObserver(()=>{this.reinitSize()}).observe(this._imageStage)}setZoomAnimation(e){this._zoomAnimation=e}reinitSize(){const e=d(this._imageStage);this._applyScaleModeImpl(e.width,e.height),this._centerImage(e.width,e.height)}async hideImage(e=g.NONE){this._zoomAnimation&&setTimeout(()=>{this._resetZoom()},I),this._stopSlideAnimation(),await h(),e==g.RIGHT?(s(this._imageStage,i.transition),t(this._imageStage,"left","-100%")):e==g.LEFT&&(s(this._imageStage,i.transition),t(this._imageStage,"left","100%")),n(this._imageStage,"opacity")}async showImage(e=g.NONE){this._zoomAnimation&&this._startZoomAnimation(),this._stopSlideAnimation(),await h(),e==g.RIGHT?(_(this._imageStage,i.transition),t(this._imageStage,"left","100%"),await h(),s(this._imageStage,i.transition),n(this._imageStage,"left")):e==g.LEFT?(_(this._imageStage,i.transition),t(this._imageStage,"left","-100%"),await h(),s(this._imageStage,i.transition),n(this._imageStage,"left")):(_(this._imageStage,i.transition),n(this._imageStage,"left")),t(this._imageStage,"opacity","1")}_createStage(){const e=y("div");return s(e,r.img_stage),s(e,i.fade),z([this._imageHandle],e),e}_centerImage(e,a){const{width:l,height:S}=d(this._imageHandle),f=(l+e)/2-l,p=(S+a)/2-S;t(this._imageHandle,"margin-left",`${f}px`),t(this._imageHandle,"margin-top",`${p}px`)}_startZoomAnimation(){s(this._imageHandle,r.img_stage__zoom)}_resetZoom(){_(this._imageHandle,r.img_stage__zoom)}_stopSlideAnimation(){t(this._imageStage,"margin-left",E(this._imageStage,"margin-left"))}}export{O as default};
