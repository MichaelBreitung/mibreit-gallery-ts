var w=Object.defineProperty;var f=(n,e,a)=>e in n?w(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a;var _=(n,e,a)=>f(n,typeof e!="symbol"?e+"":e,a);import{getElementDimension as A,addCssClass as t,addCssStyle as s,removeCssStyle as h,removeCssClass as g,createElement as k,wrapElements as p}from"../node_modules/mibreit-dom-tools/lib/index.js";import m from"./ImageStage.module.css.js";import i from"../tools/animations.module.css.js";import{ESwipeDirection as o}from"./SwipeHandler.js";import{sleepTillNextRenderFinished as r}from"../tools/AsyncSleep.js";const v=1e3;class T{constructor(e){_(this,"_zoomAnimationActive",!1);_(this,"_skewAnimationActive",!1);_(this,"_imageStage");_(this,"_imageHandle");this._imageHandle=e,this._imageStage=this._createStage(),new ResizeObserver(()=>{this.reinitSize()}).observe(this._imageStage)}setZoomAnimation(e){this._zoomAnimationActive=e}setSkewAnimation(e){this._skewAnimationActive=e}reinitSize(){const e=A(this._imageStage);this._applyScaleModeImpl(e.width,e.height),this._centerImage(e.width,e.height)}async hideImage(e=o.NONE){setTimeout(()=>{this._resetZoom(),this._resetSkew(),this._resetZoomSkew()},v),await r(),e==o.RIGHT?(t(this._imageStage,i.transition),s(this._imageStage,"left","-100%")):e==o.LEFT&&(t(this._imageStage,i.transition),s(this._imageStage,"left","100%")),h(this._imageStage,"opacity")}async showImage(e=o.NONE){e===o.NONE&&(this._zoomAnimationActive&&this._skewAnimationActive?this._startZoomSkewAnimation():(this._zoomAnimationActive&&this._startZoomAnimation(),this._skewAnimationActive&&this._startSkewAnimation())),await r(),e===o.RIGHT?(g(this._imageStage,i.transition),s(this._imageStage,"left","100%"),await r(),t(this._imageStage,i.transition),h(this._imageStage,"left")):e===o.LEFT?(g(this._imageStage,i.transition),s(this._imageStage,"left","-100%"),await r(),t(this._imageStage,i.transition),h(this._imageStage,"left")):(g(this._imageStage,i.transition),h(this._imageStage,"left")),s(this._imageStage,"opacity","1")}_createStage(){const e=k("div");return t(e,m.img_stage),t(e,i.fade),p([this._imageHandle],e),e}_centerImage(e,a){const{width:l,height:S}=A(this._imageHandle),c=(l+e)/2-l,d=(S+a)/2-S;s(this._imageHandle,"margin-left",`${c}px`),s(this._imageHandle,"margin-top",`${d}px`)}_startZoomAnimation(){t(this._imageHandle,m.img_stage__zoom)}_resetZoom(){g(this._imageHandle,m.img_stage__zoom)}_startSkewAnimation(){t(this._imageHandle,m.img_stage__skew)}_resetSkew(){g(this._imageHandle,m.img_stage__skew)}_startZoomSkewAnimation(){t(this._imageHandle,m.img_stage__zoom_skew)}_resetZoomSkew(){g(this._imageHandle,m.img_stage__zoom_skew)}}export{T as default};
