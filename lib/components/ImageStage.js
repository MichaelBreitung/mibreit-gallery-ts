var f=Object.defineProperty;var c=(m,t,i)=>t in m?f(m,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[t]=i;var g=(m,t,i)=>c(m,typeof t!="symbol"?t+"":t,i);import{getElementDimension as S,addCssStyle as e,addCssClass as s,removeCssStyle as h,removeCssClass as _,createElement as y,wrapElements as A,getComputedCssStyle as H}from"../node_modules/mibreit-dom-tools/lib/index.js";import E from"./ImageStage.module.css.js";import a from"../tools/animations.module.css.js";import{ESwipeDirection as o}from"./SwipeHandler.js";import{sleepTillNextRenderFinished as l}from"../tools/AsyncSleep.js";const I=1e3;class u{constructor(t,i,n){g(this,"_zoomAnimation",!1);g(this,"_imageStage");g(this,"_imageHandle");g(this,"_imageWidth");g(this,"_imageHeight");this._imageHandle=t,this._imageWidth=i,this._imageHeight=n,this._imageStage=this._createStage()}setZoomAnimation(t){this._zoomAnimation=t}applyScaleMode(){const t=S(this._imageStage);this._applyScaleModeImpl(t.width,t.height),this._centerImage(t.width,t.height)}setSize(t,i){e(this._imageStage,"width",t),e(this._imageStage,"height",i),this.applyScaleMode()}setMargin(t){e(this._imageStage,"margin",t)}async hideImage(t=o.NONE){this._zoomAnimation&&setTimeout(()=>{this._resetZoom()},I),this._stopSlideAnimation(),await l(),t==o.RIGHT?(s(this._imageStage,a.transition),e(this._imageStage,"left","-100%")):t==o.LEFT&&(s(this._imageStage,a.transition),e(this._imageStage,"left","100%")),h(this._imageStage,"opacity")}async showImage(t=o.NONE){this.applyScaleMode(),this._zoomAnimation&&this._startZoomAnimation(),this._stopSlideAnimation(),await l(),t==o.RIGHT?(_(this._imageStage,a.transition),e(this._imageStage,"left","100%"),await l(),s(this._imageStage,a.transition),h(this._imageStage,"left")):t==o.LEFT?(_(this._imageStage,a.transition),e(this._imageStage,"left","-100%"),await l(),s(this._imageStage,a.transition),h(this._imageStage,"left")):(_(this._imageStage,a.transition),h(this._imageStage,"left")),e(this._imageStage,"opacity","1")}_createStage(){const t=y("div");return s(t,E.img_stage),s(t,a.fade),A([this._imageHandle],t),t}_centerImage(t,i){const{width:n,height:r}=S(this._imageHandle),d=(n+t)/2-n,p=(r+i)/2-r;e(this._imageHandle,"margin-left",`${d}px`),e(this._imageHandle,"margin-top",`${p}px`)}_startZoomAnimation(){s(this._imageHandle,"zoom")}_resetZoom(){_(this._imageHandle,"zoom")}_stopSlideAnimation(){e(this._imageStage,"margin-left",H(this._imageStage,"margin-left"))}}export{u as default};
