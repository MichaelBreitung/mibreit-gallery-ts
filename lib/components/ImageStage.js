var c=Object.defineProperty;var A=(m,e,t)=>e in m?c(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var o=(m,e,t)=>A(m,typeof e!="symbol"?e+"":e,t);import{getElementDimension as f,addCssClass as s,addCssStyle as i,removeCssStyle as h,removeCssClass as r,createElement as H,wrapElements as y,getComputedCssStyle as E}from"../node_modules/mibreit-dom-tools/lib/index.js";import d from"./ImageStage.module.css.js";import a from"../tools/animations.module.css.js";import{ESwipeDirection as n}from"./SwipeHandler.js";import{sleepTillNextRenderFinished as l}from"../tools/AsyncSleep.js";const I=1e3;class O{constructor(e,t,_){o(this,"_zoomAnimation",!1);o(this,"_imageStage");o(this,"_imageHandle");o(this,"_imageWidth");o(this,"_imageHeight");this._imageHandle=e,this._imageWidth=t,this._imageHeight=_,this._imageStage=this._createStage(),new ResizeObserver(()=>{const g=f(this._imageStage);this._applyScaleModeImpl(g.width,g.height),this._centerImage(g.width,g.height)}).observe(this._imageStage)}setZoomAnimation(e){this._zoomAnimation=e}async hideImage(e=n.NONE){this._zoomAnimation&&setTimeout(()=>{this._resetZoom()},I),this._stopSlideAnimation(),await l(),e==n.RIGHT?(s(this._imageStage,a.transition),i(this._imageStage,"left","-100%")):e==n.LEFT&&(s(this._imageStage,a.transition),i(this._imageStage,"left","100%")),h(this._imageStage,"opacity")}async showImage(e=n.NONE){this._zoomAnimation&&this._startZoomAnimation(),this._stopSlideAnimation(),await l(),e==n.RIGHT?(r(this._imageStage,a.transition),i(this._imageStage,"left","100%"),await l(),s(this._imageStage,a.transition),h(this._imageStage,"left")):e==n.LEFT?(r(this._imageStage,a.transition),i(this._imageStage,"left","-100%"),await l(),s(this._imageStage,a.transition),h(this._imageStage,"left")):(r(this._imageStage,a.transition),h(this._imageStage,"left")),i(this._imageStage,"opacity","1")}_createStage(){const e=H("div");return s(e,d.img_stage),s(e,a.fade),y([this._imageHandle],e),e}_centerImage(e,t){const{width:_,height:S}=f(this._imageHandle),g=(_+e)/2-_,p=(S+t)/2-S;i(this._imageHandle,"margin-left",`${g}px`),i(this._imageHandle,"margin-top",`${p}px`)}_startZoomAnimation(){s(this._imageHandle,d.img_stage__zoom)}_resetZoom(){r(this._imageHandle,d.img_stage__zoom)}_stopSlideAnimation(){i(this._imageStage,"margin-left",E(this._imageStage,"margin-left"))}}export{O as default};
