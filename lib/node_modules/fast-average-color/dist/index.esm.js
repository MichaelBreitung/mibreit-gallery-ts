/*! Fast Average Color | Â© 2023 Denis Seleznev | MIT License | https://github.com/fast-average-color/fast-average-color */function y(r){var t=r.toString(16);return t.length===1?"0"+t:t}function p(r){return"#"+r.map(y).join("")}function D(r){var t=(r[0]*299+r[1]*587+r[2]*114)/1e3;return t<128}function S(r){return r?P(r)?r:[r]:[]}function P(r){return Array.isArray(r[0])}function b(r,t,e){for(var i=0;i<e.length;i++)if(F(r,t,e[i]))return!0;return!1}function F(r,t,e){switch(e.length){case 3:if(_(r,t,e))return!0;break;case 4:if(q(r,t,e))return!0;break;case 5:if(B(r,t,e))return!0;break;default:return!1}}function _(r,t,e){return r[t+3]!==255||r[t]===e[0]&&r[t+1]===e[1]&&r[t+2]===e[2]}function q(r,t,e){return r[t+3]&&e[3]?r[t]===e[0]&&r[t+1]===e[1]&&r[t+2]===e[2]&&r[t+3]===e[3]:r[t+3]===e[3]}function E(r,t,e){return r>=t-e&&r<=t+e}function B(r,t,e){var i=e[0],a=e[1],o=e[2],n=e[3],s=e[4],f=r[t+3],v=E(f,n,s);return n?!!(!f&&v||E(r[t],i,s)&&E(r[t+1],a,s)&&E(r[t+2],o,s)&&v):v}var x=24;function z(r,t,e){for(var i={},a=e.dominantDivider||x,o=e.ignoredColor,n=e.step,s=[0,0,0,0,0],f=0;f<t;f+=n){var v=r[f],u=r[f+1],l=r[f+2],c=r[f+3];if(!(o&&b(r,f,o))){var h=Math.round(v/a)+","+Math.round(u/a)+","+Math.round(l/a);i[h]?i[h]=[i[h][0]+v*c,i[h][1]+u*c,i[h][2]+l*c,i[h][3]+c,i[h][4]+1]:i[h]=[v*c,u*c,l*c,c,1],s[4]<i[h][4]&&(s=i[h])}}var g=s[0],A=s[1],W=s[2],m=s[3],O=s[4];return m?[Math.round(g/m),Math.round(A/m),Math.round(W/m),Math.round(m/O)]:e.defaultColor}function j(r,t,e){for(var i=0,a=0,o=0,n=0,s=0,f=e.ignoredColor,v=e.step,u=0;u<t;u+=v){var l=r[u+3],c=r[u]*l,h=r[u+1]*l,g=r[u+2]*l;f&&b(r,u,f)||(i+=c,a+=h,o+=g,n+=l,s++)}return n?[Math.round(i/n),Math.round(a/n),Math.round(o/n),Math.round(n/s)]:e.defaultColor}function G(r,t,e){for(var i=0,a=0,o=0,n=0,s=0,f=e.ignoredColor,v=e.step,u=0;u<t;u+=v){var l=r[u],c=r[u+1],h=r[u+2],g=r[u+3];f&&b(r,u,f)||(i+=l*l*g,a+=c*c*g,o+=h*h*g,n+=g,s++)}return n?[Math.round(Math.sqrt(i/n)),Math.round(Math.sqrt(a/n)),Math.round(Math.sqrt(o/n)),Math.round(n/s)]:e.defaultColor}function T(r){return M(r,"defaultColor",[0,0,0,0])}function M(r,t,e){return r[t]===void 0?e:r[t]}var H=10,C=100;function N(r){return r.search(/\.svg(\?|$)/i)!==-1}function V(r){if(w(r)){var t=r.naturalWidth,e=r.naturalHeight;return!r.naturalWidth&&N(r.src)&&(t=e=C),{width:t,height:e}}return X(r)?{width:r.videoWidth,height:r.videoHeight}:{width:r.width,height:r.height}}function L(r){return Z(r)?"canvas":k(r)?"offscreencanvas":U(r)?"imagebitmap":r.src}function w(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement}var R=typeof OffscreenCanvas<"u";function k(r){return R&&r instanceof OffscreenCanvas}function X(r){return typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement}function Z(r){return typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement}function U(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}function $(r,t){var e=M(t,"left",0),i=M(t,"top",0),a=M(t,"width",r.width),o=M(t,"height",r.height),n=a,s=o;if(t.mode==="precision")return{srcLeft:e,srcTop:i,srcWidth:a,srcHeight:o,destWidth:n,destHeight:s};var f;return a>o?(f=a/o,n=C,s=Math.round(n/f)):(f=o/a,s=C,n=Math.round(s/f)),(n>a||s>o||n<H||s<H)&&(n=a,s=o),{srcLeft:e,srcTop:i,srcWidth:a,srcHeight:o,destWidth:n,destHeight:s}}var J=typeof window>"u";function K(){return J?R?new OffscreenCanvas(1,1):null:document.createElement("canvas")}var Q="FastAverageColor: ";function d(r){return Error(Q+r)}function I(r,t){t||console.error(r)}var Y=function(){function r(){this.canvas=null,this.ctx=null}return r.prototype.getColorAsync=function(t,e){if(!t)return Promise.reject(d("call .getColorAsync() without resource"));if(typeof t=="string"){if(typeof Image>"u")return Promise.reject(d("resource as string is not supported in this environment"));var i=new Image;return i.crossOrigin=e&&e.crossOrigin||"",i.src=t,this.bindImageEvents(i,e)}else{if(w(t)&&!t.complete)return this.bindImageEvents(t,e);var a=this.getColor(t,e);return a.error?Promise.reject(a.error):Promise.resolve(a)}},r.prototype.getColor=function(t,e){e=e||{};var i=T(e);if(!t){var a=d("call .getColor() without resource");return I(a,e.silent),this.prepareResult(i,a)}var o=V(t),n=$(o,e);if(!n.srcWidth||!n.srcHeight||!n.destWidth||!n.destHeight){var a=d('incorrect sizes for resource "'.concat(L(t),'"'));return I(a,e.silent),this.prepareResult(i,a)}if(!this.canvas&&(this.canvas=K(),!this.canvas)){var a=d("OffscreenCanvas is not supported in this browser");return I(a,e.silent),this.prepareResult(i,a)}if(!this.ctx){if(this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),!this.ctx){var a=d("Canvas Context 2D is not supported in this browser");return I(a,e.silent),this.prepareResult(i)}this.ctx.imageSmoothingEnabled=!1}this.canvas.width=n.destWidth,this.canvas.height=n.destHeight;try{this.ctx.clearRect(0,0,n.destWidth,n.destHeight),this.ctx.drawImage(t,n.srcLeft,n.srcTop,n.srcWidth,n.srcHeight,0,0,n.destWidth,n.destHeight);var s=this.ctx.getImageData(0,0,n.destWidth,n.destHeight).data;return this.prepareResult(this.getColorFromArray4(s,e))}catch(f){var a=d("security error (CORS) for resource ".concat(L(t),`.
Details: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image`));return I(a,e.silent),!e.silent&&console.error(f),this.prepareResult(i,a)}},r.prototype.getColorFromArray4=function(t,e){e=e||{};var i=4,a=t.length,o=T(e);if(a<i)return o;var n=a-a%i,s=(e.step||1)*i,f;switch(e.algorithm||"sqrt"){case"simple":f=j;break;case"sqrt":f=G;break;case"dominant":f=z;break;default:throw d("".concat(e.algorithm," is unknown algorithm"))}return f(t,n,{defaultColor:o,ignoredColor:S(e.ignoredColor),step:s,dominantDivider:e.dominantDivider})},r.prototype.prepareResult=function(t,e){var i=t.slice(0,3),a=[t[0],t[1],t[2],t[3]/255],o=D(t);return{value:[t[0],t[1],t[2],t[3]],rgb:"rgb("+i.join(",")+")",rgba:"rgba("+a.join(",")+")",hex:p(i),hexa:p(t),isDark:o,isLight:!o,error:e}},r.prototype.destroy=function(){this.canvas&&(this.canvas.width=1,this.canvas.height=1,this.canvas=null),this.ctx=null},r.prototype.bindImageEvents=function(t,e){var i=this;return new Promise(function(a,o){var n=function(){v();var u=i.getColor(t,e);u.error?o(u.error):a(u)},s=function(){v(),o(d('Error loading image "'.concat(t.src,'"')))},f=function(){v(),o(d('Image "'.concat(t.src,'" loading aborted')))},v=function(){t.removeEventListener("load",n),t.removeEventListener("error",s),t.removeEventListener("abort",f)};t.addEventListener("load",n),t.addEventListener("error",s),t.addEventListener("abort",f)})},r}();export{Y as FastAverageColor};
