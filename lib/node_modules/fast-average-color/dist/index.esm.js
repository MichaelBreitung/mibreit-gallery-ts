/*! Fast Average Color | Â© 2025 Denis Seleznev | MIT License | https://github.com/fast-average-color/fast-average-color */function D(t){var r=t.toString(16);return r.length===1?"0"+r:r}function b(t){return"#"+t.map(D).join("")}function F(t){var r=(t[0]*299+t[1]*587+t[2]*114)/1e3;return r<128}function S(t){return t?P(t)?t:[t]:[]}function P(t){return Array.isArray(t[0])}function C(t,r,e){for(var i=0;i<e.length;i++)if(_(t,r,e[i]))return!0;return!1}function _(t,r,e){switch(e.length){case 3:if(q(t,r,e))return!0;break;case 4:if(B(t,r,e))return!0;break;case 5:if(V(t,r,e))return!0;break;default:return!1}}function q(t,r,e){return t[r+3]!==255||t[r]===e[0]&&t[r+1]===e[1]&&t[r+2]===e[2]}function B(t,r,e){return t[r+3]&&e[3]?t[r]===e[0]&&t[r+1]===e[1]&&t[r+2]===e[2]&&t[r+3]===e[3]:t[r+3]===e[3]}function E(t,r,e){return t>=r-e&&t<=r+e}function V(t,r,e){var i=e[0],a=e[1],o=e[2],n=e[3],s=e[4],f=t[r+3],h=E(f,n,s);return n?!!(!f&&h||E(t[r],i,s)&&E(t[r+1],a,s)&&E(t[r+2],o,s)&&h):h}var x=24;function z(t,r,e){for(var i={},a=e.dominantDivider||x,o=e.ignoredColor,n=e.step,s=[0,0,0,0,0],f=0;f<r;f+=n){var h=t[f],u=t[f+1],d=t[f+2],c=t[f+3];if(!(o&&C(t,f,o))){var v=Math.round(h/a)+","+Math.round(u/a)+","+Math.round(d/a);i[v]?i[v]=[i[v][0]+h*c,i[v][1]+u*c,i[v][2]+d*c,i[v][3]+c,i[v][4]+1]:i[v]=[h*c,u*c,d*c,c,1],s[4]<i[v][4]&&(s=i[v])}}var g=s[0],A=s[1],O=s[2],m=s[3],y=s[4];return m?[Math.round(g/m),Math.round(A/m),Math.round(O/m),Math.round(m/y)]:e.defaultColor}function j(t,r,e){for(var i=0,a=0,o=0,n=0,s=0,f=e.ignoredColor,h=e.step,u=0;u<r;u+=h){var d=t[u+3],c=t[u]*d,v=t[u+1]*d,g=t[u+2]*d;f&&C(t,u,f)||(i+=c,a+=v,o+=g,n+=d,s++)}return n?[Math.round(i/n),Math.round(a/n),Math.round(o/n),Math.round(n/s)]:e.defaultColor}function G(t,r,e){for(var i=0,a=0,o=0,n=0,s=0,f=e.ignoredColor,h=e.step,u=0;u<r;u+=h){var d=t[u],c=t[u+1],v=t[u+2],g=t[u+3];f&&C(t,u,f)||(i+=d*d*g,a+=c*c*g,o+=v*v*g,n+=g,s++)}return n?[Math.round(Math.sqrt(i/n)),Math.round(Math.sqrt(a/n)),Math.round(Math.sqrt(o/n)),Math.round(n/s)]:e.defaultColor}function T(t){return M(t,"defaultColor",[0,0,0,0])}function M(t,r,e){return t[r]===void 0?e:t[r]}var H=10,p=100;function N(t){return t.search(/\.svg(\?|$)/i)!==-1}function k(t){if(L(t)){var r=t.naturalWidth,e=t.naturalHeight;return!t.naturalWidth&&N(t.src)&&(r=e=p),{width:r,height:e}}return Z(t)?{width:t.videoWidth,height:t.videoHeight}:W(t)?{width:t.codedWidth,height:t.codedHeight}:{width:t.width,height:t.height}}function w(t){return U(t)?"canvas":X(t)?"offscreencanvas":W(t)?"videoframe":$(t)?"imagebitmap":t.src}function L(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement}var R=typeof OffscreenCanvas<"u";function X(t){return R&&t instanceof OffscreenCanvas}function Z(t){return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement}function W(t){return typeof VideoFrame<"u"&&t instanceof VideoFrame}function U(t){return typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement}function $(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap}function J(t,r){var e=M(r,"left",0),i=M(r,"top",0),a=M(r,"width",t.width),o=M(r,"height",t.height),n=a,s=o;if(r.mode==="precision")return{srcLeft:e,srcTop:i,srcWidth:a,srcHeight:o,destWidth:n,destHeight:s};var f;return a>o?(f=a/o,n=p,s=Math.round(n/f)):(f=o/a,s=p,n=Math.round(s/f)),(n>a||s>o||n<H||s<H)&&(n=a,s=o),{srcLeft:e,srcTop:i,srcWidth:a,srcHeight:o,destWidth:n,destHeight:s}}var K=typeof window>"u";function Q(){return K?R?new OffscreenCanvas(1,1):null:document.createElement("canvas")}var Y="FastAverageColor: ";function l(t){return Error(Y+t)}function I(t,r){r||console.error(t)}var tt=function(){function t(){this.canvas=null,this.ctx=null}return t.prototype.getColorAsync=function(r,e){if(!r)return Promise.reject(l("call .getColorAsync() without resource"));if(typeof r=="string"){if(typeof Image>"u")return Promise.reject(l("resource as string is not supported in this environment"));var i=new Image;return i.crossOrigin=e&&e.crossOrigin||"",i.src=r,this.bindImageEvents(i,e)}else{if(L(r)&&!r.complete)return this.bindImageEvents(r,e);var a=this.getColor(r,e);return a.error?Promise.reject(a.error):Promise.resolve(a)}},t.prototype.getColor=function(r,e){e=e||{};var i=T(e);if(!r){var a=l("call .getColor() without resource");return I(a,e.silent),this.prepareResult(i,a)}var o=k(r),n=J(o,e);if(!n.srcWidth||!n.srcHeight||!n.destWidth||!n.destHeight){var a=l('incorrect sizes for resource "'.concat(w(r),'"'));return I(a,e.silent),this.prepareResult(i,a)}if(!this.canvas&&(this.canvas=Q(),!this.canvas)){var a=l("OffscreenCanvas is not supported in this browser");return I(a,e.silent),this.prepareResult(i,a)}if(!this.ctx){if(this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),!this.ctx){var a=l("Canvas Context 2D is not supported in this browser");return I(a,e.silent),this.prepareResult(i)}this.ctx.imageSmoothingEnabled=!1}this.canvas.width=n.destWidth,this.canvas.height=n.destHeight;try{this.ctx.clearRect(0,0,n.destWidth,n.destHeight),this.ctx.drawImage(r,n.srcLeft,n.srcTop,n.srcWidth,n.srcHeight,0,0,n.destWidth,n.destHeight);var s=this.ctx.getImageData(0,0,n.destWidth,n.destHeight).data;return this.prepareResult(this.getColorFromArray4(s,e))}catch(f){var a=l("security error (CORS) for resource ".concat(w(r),`.
Details: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image`));return I(a,e.silent),e.silent||console.error(f),this.prepareResult(i,a)}},t.prototype.getColorFromArray4=function(r,e){e=e||{};var i=4,a=r.length,o=T(e);if(a<i)return o;var n=a-a%i,s=(e.step||1)*i,f;switch(e.algorithm||"sqrt"){case"simple":f=j;break;case"sqrt":f=G;break;case"dominant":f=z;break;default:throw l("".concat(e.algorithm," is unknown algorithm"))}return f(r,n,{defaultColor:o,ignoredColor:S(e.ignoredColor),step:s,dominantDivider:e.dominantDivider})},t.prototype.prepareResult=function(r,e){var i=r.slice(0,3),a=[r[0],r[1],r[2],r[3]/255],o=F(r);return{value:[r[0],r[1],r[2],r[3]],rgb:"rgb("+i.join(",")+")",rgba:"rgba("+a.join(",")+")",hex:b(i),hexa:b(r),isDark:o,isLight:!o,error:e}},t.prototype.destroy=function(){this.canvas&&(this.canvas.width=1,this.canvas.height=1,this.canvas=null),this.ctx=null},t.prototype.bindImageEvents=function(r,e){var i=this;return new Promise(function(a,o){var n=function(){h();var u=i.getColor(r,e);u.error?o(u.error):a(u)},s=function(){h(),o(l('Error loading image "'.concat(r.src,'"')))},f=function(){h(),o(l('Image "'.concat(r.src,'" loading aborted')))},h=function(){r.removeEventListener("load",n),r.removeEventListener("error",s),r.removeEventListener("abort",f)};r.addEventListener("load",n),r.addEventListener("error",s),r.addEventListener("abort",f)})},t}();export{tt as FastAverageColor};
